<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life OS - Command Center</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00d4ff;
            --secondary: #0099ff;
            --accent: #ff006e;
            --success: #00ff88;
            --warning: #ffaa00;
            --bg-dark: #0a0e27;
            --bg-darker: #050810;
            --text-primary: #e0f7ff;
            --text-secondary: #7dd3fc;
            --glow-primary: 0 0 20px rgba(0, 212, 255, 0.3);
            --glow-accent: 0 0 20px rgba(255, 0, 110, 0.3);
        }

        /* Light Theme */
        body.light-theme {
            --primary: #0066cc;
            --secondary: #0099ff;
            --accent: #cc0066;
            --success: #009900;
            --warning: #ff9900;
            --bg-dark: #f5f5f5;
            --bg-darker: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --glow-primary: 0 0 20px rgba(0, 102, 204, 0.15);
            --glow-accent: 0 0 20px rgba(204, 0, 102, 0.15);
        }

        body.light-theme body::before {
            opacity: 0.1;
        }

        body {
            font-family: 'Space Mono', monospace;
            background: radial-gradient(ellipse at 50% 0%, rgba(0, 99, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(ellipse at 0% 50%, rgba(0, 212, 255, 0.05) 0%, transparent 50%),
                        var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 212, 255, 0.02) 0px,
                    rgba(0, 212, 255, 0.02) 1px,
                    transparent 1px,
                    transparent 2px
                );
            pointer-events: none;
            z-index: -1;
            opacity: 0.5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInDown 0.8s ease-out;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 8px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: 600;
        }

        .theme-toggle:hover {
            background: rgba(0, 212, 255, 0.3);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        h1 {
            font-family: 'Orbitron', monospace;
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: 3px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            text-shadow: 0 0 40px rgba(0, 212, 255, 0.3);
            filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.2));
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 10px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .status-line {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            font-size: 0.85rem;
            letter-spacing: 1px;
            animation: fadeInUp 0.8s ease-out 0.4s both;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            box-shadow: var(--glow-primary);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* View Modes */
        .view-container {
            animation: fadeIn 0.6s ease-out;
        }

        .hidden-view {
            display: none;
        }

        /* Dashboard Overview Grid */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out 0.6s both;
        }

        /* Module Card */
        .module-card {
            background: rgba(10, 14, 39, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.15);
            border-radius: 8px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            cursor: pointer;
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }

        .module-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.05) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .module-card:hover {
            background: rgba(10, 14, 39, 0.6);
            border-color: rgba(0, 212, 255, 0.3);
            box-shadow: inset 0 0 40px rgba(0, 212, 255, 0.05),
                        0 0 40px rgba(0, 212, 255, 0.1);
            transform: translateY(-4px);
        }

        .module-card:hover::before {
            opacity: 1;
        }

        .corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary);
            opacity: 0.5;
        }

        .corner.top-left {
            top: 0;
            left: 0;
            border-right: none;
            border-bottom: none;
        }

        .corner.top-right {
            top: 0;
            right: 0;
            border-left: none;
            border-bottom: none;
        }

        .corner.bottom-left {
            bottom: 0;
            left: 0;
            border-right: none;
            border-top: none;
        }

        .corner.bottom-right {
            bottom: 0;
            right: 0;
            border-left: none;
            border-top: none;
        }

        .module-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            position: relative;
            z-index: 10;
        }

        .module-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
        }

        .module-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--primary);
            border-radius: 4px;
            font-size: 1rem;
            box-shadow: var(--glow-primary);
        }

        .module-badge {
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-weight: 700;
        }

        .module-status {
            display: flex;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
            position: relative;
            z-index: 10;
        }

        .status-count {
            color: var(--primary);
            font-weight: 700;
        }

        .module-mini-progress {
            width: 100%;
            height: 4px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 16px;
            position: relative;
            z-index: 10;
        }

        .module-mini-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
            box-shadow: var(--glow-primary);
        }

        .module-description {
            flex: 1;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
            position: relative;
            z-index: 10;
            margin-bottom: 16px;
        }

        .module-action {
            align-self: flex-start;
            font-size: 0.8rem;
            color: var(--primary);
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            opacity: 0.7;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .module-card:hover .module-action {
            opacity: 1;
        }

        /* Detail View */
        .detail-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 30px;
            position: relative;
            z-index: 10;
        }

        .back-btn {
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            box-shadow: var(--glow-primary);
        }

        .back-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
        }

        .detail-title {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--primary);
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Detail Panel */
        .detail-panel {
            background: rgba(10, 14, 39, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.15);
            border-radius: 8px;
            padding: 30px;
            position: relative;
            margin-bottom: 30px;
        }

        .detail-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.05) 0%, transparent 70%);
        }

        .detail-content {
            position: relative;
            z-index: 10;
        }

        .circular-progress-large {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: conic-gradient(
                var(--primary) 0deg,
                var(--primary) var(--progress-angle, 0deg),
                rgba(0, 212, 255, 0.1) var(--progress-angle, 0deg)
            );
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: var(--glow-primary), inset 0 0 20px rgba(0, 212, 255, 0.1);
            margin: 0 auto 30px;
        }

        .circular-progress-large::before {
            content: '';
            position: absolute;
            width: 90%;
            height: 90%;
            background: var(--bg-dark);
            border-radius: 50%;
        }

        .progress-text-large {
            position: relative;
            z-index: 10;
            text-align: center;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
        }

        .progress-percentage-large {
            color: var(--primary);
            font-size: 2rem;
            display: block;
        }

        .progress-label-large {
            color: var(--text-secondary);
            font-size: 0.85rem;
            display: block;
            letter-spacing: 1px;
            margin-top: 4px;
        }

        .checklist {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 24px 0;
        }

        .check-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0, 99, 255, 0.08);
            border-left: 3px solid rgba(0, 212, 255, 0.3);
            border-radius: 2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .check-item:hover {
            background: rgba(0, 212, 255, 0.15);
            border-left-color: var(--primary);
            box-shadow: inset 0 0 10px rgba(0, 212, 255, 0.1);
        }

        .check-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
            filter: drop-shadow(0 0 5px rgba(0, 212, 255, 0.5));
        }

        .check-item label {
            flex: 1;
            cursor: pointer;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .check-item input[type="checkbox"]:checked + label {
            color: var(--text-secondary);
            text-decoration: line-through;
        }

        .task-actions {
            display: flex;
            gap: 6px;
            margin-left: auto;
        }

        .task-btn {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            text-transform: uppercase;
            font-weight: 600;
        }

        .task-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--primary);
        }

        .task-btn.delete:hover {
            background: rgba(255, 0, 110, 0.2);
            border-color: var(--accent);
            color: var(--accent);
        }

        .task-btn.edit:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: var(--success);
            color: var(--success);
        }

        .task-item-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
        }

        /* Export Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-darker);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(0, 212, 255, 0.2);
            animation: fadeIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            padding-bottom: 15px;
        }

        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: var(--accent);
        }

        .export-textarea {
            width: 100%;
            height: 300px;
            background: rgba(0, 99, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 12px;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            margin-bottom: 15px;
            resize: none;
            overflow-y: auto;
        }

        .export-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-btn {
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .modal-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .modal-btn:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        /* Global keyboard focus styles */
        button:focus-visible, input:focus-visible, textarea:focus-visible, select:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        input:focus-visible, textarea:focus-visible {
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3), inset 0 0 10px rgba(0, 212, 255, 0.1);
        }

        /* Header button focus */
        header button:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .modal-btn.download {
            background: rgba(0, 255, 136, 0.15);
            border-color: var(--success);
            color: var(--success);
        }

        .modal-btn.download:hover {
            background: rgba(0, 255, 136, 0.3);
            border-color: var(--success);
        }

        /* Notes & Subtasks Modal */
        .notes-section {
            margin-bottom: 20px;
        }

        .notes-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }

        .notes-textarea {
            width: 100%;
            height: 120px;
            background: rgba(0, 99, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 12px;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            resize: none;
            margin-bottom: 15px;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .subtasks-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 99, 255, 0.08);
            border-radius: 4px;
            border-left: 3px solid rgba(0, 212, 255, 0.3);
        }

        .subtask-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .subtask-item label {
            flex: 1;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .subtask-item input[type="checkbox"]:checked + label {
            color: var(--text-secondary);
            text-decoration: line-through;
        }

        .subtask-delete {
            background: transparent;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 1rem;
            transition: color 0.2s ease;
        }

        .subtask-delete:hover {
            color: #ff3366;
        }

        .subtask-input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .subtask-input {
            flex: 1;
            background: rgba(0, 99, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 10px;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
        }

        .subtask-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
        }

        .subtask-add-btn {
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 10px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            text-transform: uppercase;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .subtask-add-btn:hover {
            background: rgba(0, 255, 136, 0.3);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        /* Heatmap Styles */
        .heatmap-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s ease;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }

        .heatmap-cell.activity-0 {
            background: rgba(0, 212, 255, 0.05);
            color: var(--text-secondary);
        }

        .heatmap-cell.activity-1 {
            background: rgba(0, 212, 255, 0.2);
            color: var(--text-primary);
        }

        .heatmap-cell.activity-2 {
            background: rgba(0, 212, 255, 0.4);
            color: var(--bg-darker);
        }

        .heatmap-cell.activity-3 {
            background: rgba(0, 212, 255, 0.6);
            color: var(--bg-darker);
        }

        .heatmap-cell.activity-4 {
            background: var(--primary);
            color: var(--bg-darker);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.6);
        }

        .heatmap-legend {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 99, 255, 0.08);
            border-radius: 4px;
        }

        .heatmap-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .heatmap-legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .heatmap-day-label {
            font-size: 0.75rem;
            text-align: center;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 10px;
            padding: 0 5px;
        }

        .heatmap-days-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 5px;
        }

        .add-task-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(0, 212, 255, 0.2);
        }

        .input-field {
            width: 100%;
            background: rgba(0, 99, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2), inset 0 0 10px rgba(0, 212, 255, 0.1);
        }

        .input-field::placeholder {
            color: rgba(0, 212, 255, 0.4);
        }

        .btn {
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 0.85rem;
            margin-top: 12px;
            transition: all 0.3s ease;
            box-shadow: var(--glow-primary);
        }

        .btn:hover {
            background: rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.4), inset 0 0 10px rgba(0, 212, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .stat-box {
            background: rgba(0, 212, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.2);
            padding: 16px;
            border-radius: 4px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-top: 6px;
            font-weight: 600;
        }

        /* Priority and Time Estimate Styles */
        .priority-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .priority-high {
            background: var(--accent);
            box-shadow: 0 0 8px var(--accent);
        }

        .priority-medium {
            background: var(--warning);
            box-shadow: 0 0 8px var(--warning);
        }

        .priority-low {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }

        .task-meta {
            display: flex;
            gap: 12px;
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(0, 212, 255, 0.1);
            padding: 2px 8px;
            border-radius: 3px;
        }

        .add-task-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .select-field {
            background: rgba(0, 99, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 10px 12px;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .select-field:focus {
            outline: none;
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .select-field option {
            background: var(--bg-darker);
            color: var(--text-primary);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--text-primary);
            padding: 8px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .filter-btn.active {
            background: rgba(0, 212, 255, 0.3);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .filter-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--primary);
        }

        /* Global Stats Dashboard */
        .global-stats {
            margin-bottom: 40px;
        }

        .global-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .global-stat-box {
            background: rgba(10, 14, 39, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.15);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .global-stat-box:hover {
            background: rgba(10, 14, 39, 0.6);
            border-color: rgba(0, 212, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.1);
        }

        .global-stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            display: block;
            margin-bottom: 8px;
        }

        .global-stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .section-divider {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 3px;
            margin: 60px 0 40px 0;
            padding: 20px;
            text-transform: uppercase;
            color: var(--primary);
            border-top: 1px solid rgba(0, 212, 255, 0.2);
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            text-align: center;
            position: relative;
            animation: fadeInUp 0.8s ease-out both;
        }

        .section-divider::before,
        .section-divider::after {
            content: '//';
            margin: 0 20px;
            color: var(--text-secondary);
            opacity: 0.6;
        }

        footer {
            text-align: center;
            margin-top: 80px;
            padding: 40px 20px;
            border-top: 1px solid rgba(0, 212, 255, 0.2);
            color: var(--text-secondary);
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
                letter-spacing: 2px;
            }

            .overview-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .detail-title {
                font-size: 1.5rem;
            }

            .status-line {
                flex-direction: column;
                gap: 12px;
            }
        }

        /* ============================================
           TOOLTIP SYSTEM
           ============================================ */

        .help-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            min-width: 18px;
            border-radius: 50%;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.4);
            color: var(--primary);
            font-size: 0.75rem;
            font-weight: 700;
            cursor: help;
            margin-left: 6px;
            transition: all 0.2s ease;
            position: relative;
        }

        .help-icon:hover {
            background: rgba(0, 212, 255, 0.3);
            border-color: rgba(0, 212, 255, 0.6);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .tooltip {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-darker);
            border: 1px solid var(--primary);
            border-radius: 4px;
            padding: 10px 12px;
            font-size: 0.85rem;
            color: var(--text-primary);
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            line-height: 1.4;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid var(--primary);
        }

        .help-icon:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Help modal styles */
        #helpModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        #helpModal.active {
            display: flex;
        }

        .help-modal-content {
            background: var(--bg-dark);
            border: 2px solid var(--primary);
            border-radius: 8px;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            margin: auto;
            padding: 30px;
            color: var(--text-primary);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .help-modal-content h2 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .help-modal-content h3 {
            color: var(--secondary);
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .help-modal-content p {
            margin: 10px 0;
            line-height: 1.6;
        }

        .help-section {
            margin-bottom: 25px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .shortcut-key {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.4);
            border-radius: 3px;
            padding: 4px 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--primary);
            min-width: 100px;
            text-align: center;
        }

        .shortcut-description {
            flex: 1;
            margin-left: 15px;
            color: var(--text-secondary);
        }

        .help-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-modal-close:hover {
            color: var(--secondary);
            transform: scale(1.2);
        }

        /* First-time onboarding banner */
        .onboarding-banner {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(0, 153, 255, 0.1) 100%);
            border: 2px solid var(--primary);
            border-radius: 6px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 15px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .onboarding-banner.active {
            display: flex;
        }

        .onboarding-icon {
            font-size: 1.5rem;
            min-width: 24px;
            text-align: center;
        }

        .onboarding-content {
            flex: 1;
        }

        .onboarding-title {
            color: var(--primary);
            font-weight: 600;
            margin: 0 0 5px 0;
        }

        .onboarding-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0;
        }

        .onboarding-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.2s ease;
        }

        .onboarding-close:hover {
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header role="banner">
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle between light and dark theme" aria-pressed="false" id="themeToggle">üåì LIGHT</button>
            <h1>‚ö° LIFE OS</h1>
            <p class="subtitle">Advanced Personal Operating System</p>
            <div class="status-line">
                <div class="status-item">
                    <span class="status-dot"></span>
                    <span>SYSTEM ONLINE</span>
                </div>
                <div class="status-item">
                    <span class="status-dot"></span>
                    <span>ALL MODULES ACTIVE</span>
                </div>
                <div class="status-item">
                    <span class="status-dot"></span>
                    <span>NEURAL SYNC OK</span>
                </div>
                <button style="margin-left: 30px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0, 212, 255, 0.3)'; this.style.boxShadow='0 0 15px rgba(0, 212, 255, 0.3)'" onmouseout="this.style.background='rgba(0, 212, 255, 0.15)'; this.style.boxShadow='none'" onclick="generateWeeklyDigest()" aria-label="Generate weekly digest report with task statistics and completion metrics" aria-expanded="false" id="weeklyDigestBtn">üìä WEEKLY DIGEST</button>
                <button style="margin-left: 10px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0, 212, 255, 0.3)'; this.style.boxShadow='0 0 15px rgba(0, 212, 255, 0.3)'" onmouseout="this.style.background='rgba(0, 212, 255, 0.15)'; this.style.boxShadow='none'" onclick="sendTaskNotifications()" id="notificationBtn" aria-label="Send browser notifications for pending and high-priority tasks" aria-pressed="false">üîî NOTIFY</button>
                <button style="margin-left: 10px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0, 212, 255, 0.3)'; this.style.boxShadow='0 0 15px rgba(0, 212, 255, 0.3)'" onmouseout="this.style.background='rgba(0, 212, 255, 0.15)'; this.style.boxShadow='none'" onclick="openHeatmapModal()" aria-label="View 90-day activity heatmap showing task completion intensity" aria-expanded="false" id="heatmapBtn">üìà HEATMAP</button>
                <button style="margin-left: 10px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0, 212, 255, 0.3)'; this.style.boxShadow='0 0 15px rgba(0, 212, 255, 0.3)'" onmouseout="this.style.background='rgba(0, 212, 255, 0.15)'; this.style.boxShadow='none'" onclick="openAnalyticsModal()" aria-label="View performance analytics with 30-day metrics and trends" aria-expanded="false" id="analyticsBtn">üìâ ANALYTICS</button>
                <button style="margin-left: 10px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0, 212, 255, 0.3)'; this.style.boxShadow='0 0 15px rgba(0, 212, 255, 0.3)'" onmouseout="this.style.background='rgba(0, 212, 255, 0.15)'; this.style.boxShadow='none'" onclick="openSyncModal()" aria-label="Sync center for data export, import, and GitHub integration" aria-expanded="false" id="syncBtn">‚öôÔ∏è SYNC</button>
                <button style="margin-left: 10px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0, 212, 255, 0.3)'; this.style.boxShadow='0 0 15px rgba(0, 212, 255, 0.3)'" onmouseout="this.style.background='rgba(0, 212, 255, 0.15)'; this.style.boxShadow='none'" onclick="openHelpModal()" aria-label="Open help and reference guide (Cmd+?)" aria-expanded="false" id="helpBtn">‚ùì HELP</button>
                <button style="margin-left: 20px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease; opacity: 0.5;" onmouseover="if(!this.disabled) { this.style.background='rgba(0, 212, 255, 0.3)'; this.style.boxShadow='0 0 15px rgba(0, 212, 255, 0.3)' }" onmouseout="if(!this.disabled) { this.style.background='rgba(0, 212, 255, 0.15)'; this.style.boxShadow='none' }" onclick="undoAction()" aria-label="Undo last action (Cmd+Z)" id="undoBtn" disabled>‚Ü∂ UNDO</button>
                <button style="margin-left: 8px; background: rgba(0, 212, 255, 0.15); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.5px; text-transform: uppercase; font-weight: 600; transition: all 0.3s ease; opacity: 0.5;" onmouseover="if(!this.disabled) { this.style.background='rgba(0, 212, 255, 0.3)'; this.style.boxShadow='0 0 15px rgba(0, 212, 255, 0.3)' }" onmouseout="if(!this.disabled) { this.style.background='rgba(0, 212, 255, 0.15)'; this.style.boxShadow='none' }" onclick="redoAction()" aria-label="Redo last undone action (Cmd+Shift+Z)" id="redoBtn" disabled>‚Ü∑ REDO</button>
            </div>
        </header>

        <!-- Dashboard Overview View -->
        <div id="overviewView" class="view-container">
            <div class="section-divider">üìä Command Center</div>

            <!-- Global Stats Dashboard -->
            <div class="global-stats" id="globalStats" style="display: none;">
                <div class="section-divider" style="margin: 40px 0 20px 0; font-size: 1rem;">‚ö° Global Statistics</div>
                <div class="global-stats-grid" id="globalStatsGrid">
                    <!-- Stats will be populated by JavaScript -->
                </div>
            </div>

            <div class="overview-grid" id="moduleGrid">
                <!-- Modules will be populated by JavaScript -->
            </div>
        </div>

        <!-- Detail View -->
        <div id="detailView" class="view-container hidden-view">
            <div class="detail-header">
                <button class="back-btn" onclick="backToDashboard()">‚Üê BACK</button>
                <div class="detail-title">
                    <span id="detailIcon"></span>
                    <span id="detailName"></span>
                </div>
            </div>

            <div class="detail-panel">
                <div class="detail-content">
                    <div class="circular-progress-large" id="detailCircle" style="--progress-angle: 0deg;">
                        <div class="progress-text-large">
                            <span class="progress-percentage-large" id="detailPercent">0</span>%<br>
                            <span class="progress-label-large">COMPLETE</span>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <span class="stat-value" id="detailComplete">0</span>
                            <span class="stat-label">COMPLETED</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-value" id="detailTotal">0</span>
                            <span class="stat-label">TOTAL</span>
                        </div>
                    </div>

                    <!-- Filter Buttons -->
                    <div class="filter-buttons" id="filterButtons">
                        <button class="filter-btn active" onclick="setFilter('all')">ALL TASKS</button>
                        <button class="filter-btn" onclick="setFilter('today')">TODAY</button>
                        <button class="filter-btn" onclick="setFilter('week')">THIS WEEK</button>
                        <button class="filter-btn" onclick="setFilter('high')">HIGH PRIORITY</button>
                        <button class="filter-btn" onclick="exportModuleMarkdown()">üì• EXPORT MD</button>
                    </div>

                    <div id="detailChecklist" class="checklist"></div>

                    <div class="add-task-section">
                        <div class="add-task-form">
                            <input type="text" id="detailInput" class="input-field" placeholder="// task description...">
                            <div class="form-row">
                                <select id="prioritySelect" class="select-field">
                                    <option value="medium">PRIORITY: MEDIUM</option>
                                    <option value="high">PRIORITY: HIGH</option>
                                    <option value="low">PRIORITY: LOW</option>
                                </select>
                                <select id="recurrenceSelect" class="select-field">
                                    <option value="none">RECURRING: NONE</option>
                                    <option value="daily">RECURRING: DAILY</option>
                                    <option value="weekly">RECURRING: WEEKLY</option>
                                    <option value="monthly">RECURRING: MONTHLY</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <input type="number" id="estimateInput" class="input-field" placeholder="TIME ESTIMATE (hours)" min="0" max="1000" step="0.5" value="1">
                            </div>
                            <button class="btn" onclick="addDetailTask()">EXECUTE TASK</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div id="exportModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="exportModalTitle" onclick="if(event.target === this) closeExportModal()">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="exportModalTitle">üì• EXPORT MARKDOWN</div>
                    <button class="modal-close" onclick="closeExportModal()" aria-label="Close export dialog">‚úï</button>
                </div>
                <textarea id="exportTextarea" class="export-textarea" readonly></textarea>
                <div class="modal-buttons">
                    <button class="modal-btn" onclick="copyExportToClipboard()">üìã COPY</button>
                    <button class="modal-btn download" onclick="downloadExportFile()">‚¨áÔ∏è DOWNLOAD</button>
                </div>
            </div>
        </div>

        <!-- Heatmap Modal -->
        <div id="heatmapModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="heatmapModalTitle" onclick="if(event.target === this) closeHeatmapModal()">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <div class="modal-title" id="heatmapModalTitle">üìà ACTIVITY HEATMAP</div>
                    <button class="modal-close" onclick="closeHeatmapModal()" aria-label="Close heatmap dialog">‚úï</button>
                </div>
                <div class="heatmap-container">
                    <div id="heatmapContent" style="overflow-y: auto; max-height: 500px;"></div>
                    <div class="heatmap-legend">
                        <div class="heatmap-legend-item">
                            <div class="heatmap-legend-color" style="background: rgba(0, 212, 255, 0.05);"></div>
                            <span>No Activity</span>
                        </div>
                        <div class="heatmap-legend-item">
                            <div class="heatmap-legend-color" style="background: rgba(0, 212, 255, 0.2);"></div>
                            <span>Low (1-25%)</span>
                        </div>
                        <div class="heatmap-legend-item">
                            <div class="heatmap-legend-color" style="background: rgba(0, 212, 255, 0.4);"></div>
                            <span>Medium (26-50%)</span>
                        </div>
                        <div class="heatmap-legend-item">
                            <div class="heatmap-legend-color" style="background: rgba(0, 212, 255, 0.6);"></div>
                            <span>High (51-75%)</span>
                        </div>
                        <div class="heatmap-legend-item">
                            <div class="heatmap-legend-color" style="background: var(--primary); box-shadow: 0 0 10px rgba(0, 212, 255, 0.6);"></div>
                            <span>Very High (76-100%)</span>
                        </div>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn" onclick="closeHeatmapModal()">CLOSE</button>
                </div>
            </div>
        </div>

        <!-- Weekly Digest Modal -->
        <div id="digestModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="digestModalTitle" onclick="if(event.target === this) closeDigestModal()">
            <div class="modal-content" style="max-width: 800px; max-height: 85vh;">
                <div class="modal-header">
                    <div class="modal-title" id="digestModalTitle">üìä WEEKLY DIGEST REPORT</div>
                    <button class="modal-close" onclick="closeDigestModal()" aria-label="Close digest dialog">‚úï</button>
                </div>
                <div id="digestContent" style="overflow-y: auto; height: 500px; padding: 20px; background: rgba(0, 99, 255, 0.08); border-radius: 4px; margin-bottom: 20px; font-size: 0.9rem; line-height: 1.6;"></div>
                <div class="modal-buttons">
                    <button class="modal-btn" onclick="closeDigestModal()">CLOSE</button>
                    <button class="modal-btn" onclick="copyDigestToClipboard()">üìã COPY</button>
                    <button class="modal-btn download" onclick="downloadDigestReport()">‚¨áÔ∏è DOWNLOAD</button>
                </div>
            </div>
        </div>

        <!-- Notes & Subtasks Modal -->
        <div id="notesModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="notesModalTitle" onclick="if(event.target === this) closeNotesModal()">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <div class="modal-title" id="notesModalTitle">üìù TASK DETAILS</div>
                    <button class="modal-close" onclick="closeNotesModal()" aria-label="Close task details dialog">‚úï</button>
                </div>

                <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(0, 212, 255, 0.2);">
                    <div style="color: var(--primary); font-size: 1.1rem; font-weight: 700;" id="notesTaskTitle"></div>
                </div>

                <div class="notes-section">
                    <label class="notes-label">üìã Notes</label>
                    <textarea id="notesText" class="notes-textarea" placeholder="Add detailed notes about this task..."></textarea>
                </div>

                <div class="notes-section">
                    <label class="notes-label">‚úì Subtasks</label>
                    <div class="subtask-input-row">
                        <input type="text" id="subtaskInput" class="subtask-input" placeholder="Add a subtask..." />
                        <button class="subtask-add-btn" onclick="addSubtask()">+ ADD</button>
                    </div>
                    <div id="subtasksList" class="subtasks-list"></div>
                </div>

                <div class="modal-buttons">
                    <button class="modal-btn" onclick="closeNotesModal()">CLOSE</button>
                    <button class="modal-btn download" onclick="saveTaskDetails()">üíæ SAVE</button>
                </div>
            </div>
        </div>

        <!-- Analytics Modal -->
        <div id="analyticsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="analyticsModalTitle" onclick="if(event.target === this) closeAnalyticsModal()">
            <div class="modal-content" style="max-width: 1000px; max-height: 85vh;">
                <div class="modal-header">
                    <div class="modal-title" id="analyticsModalTitle">üìâ PERFORMANCE ANALYTICS</div>
                    <button class="modal-close" onclick="closeAnalyticsModal()" aria-label="Close analytics dialog">‚úï</button>
                </div>
                <div id="analyticsContent" style="overflow-y: auto; height: 550px; padding: 20px; background: rgba(0, 99, 255, 0.08); border-radius: 4px; margin-bottom: 20px; font-size: 0.85rem; line-height: 1.6;"></div>
                <div class="modal-buttons">
                    <button class="modal-btn" onclick="closeAnalyticsModal()">CLOSE</button>
                    <button class="modal-btn" onclick="copyAnalyticsToClipboard()">üìã COPY</button>
                    <button class="modal-btn download" onclick="downloadAnalyticsReport()">‚¨áÔ∏è DOWNLOAD</button>
                </div>
            </div>
        </div>

        <!-- Sync Modal -->
        <div id="syncModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="syncModalTitle" onclick="if(event.target === this) closeSyncModal()">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <div class="modal-title" id="syncModalTitle">‚öôÔ∏è SYNC & INTEGRATION CENTER</div>
                    <button class="modal-close" onclick="closeSyncModal()" aria-label="Close sync center dialog">‚úï</button>
                </div>

                <!-- Sync Tabs -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid rgba(0, 212, 255, 0.2); padding-bottom: 15px;">
                    <button onclick="showSyncTab('export')" id="tab-export" class="sync-tab-btn active" style="background: rgba(0, 212, 255, 0.2); color: var(--primary); border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-weight: 600; font-size: 0.8rem;">üì• EXPORT</button>
                    <button onclick="showSyncTab('import')" id="tab-import" class="sync-tab-btn" style="background: transparent; color: var(--text-secondary); border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-weight: 600; font-size: 0.8rem;">üì§ IMPORT</button>
                    <button onclick="showSyncTab('github')" id="tab-github" class="sync-tab-btn" style="background: transparent; color: var(--text-secondary); border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-family: 'Space Mono', monospace; font-weight: 600; font-size: 0.8rem;">üêô GITHUB</button>
                </div>

                <!-- Export Tab -->
                <div id="syncTab-export" class="sync-tab-content">
                    <h4 style="color: var(--primary); margin-bottom: 15px;">üì• EXPORT YOUR DATA</h4>
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">Download all your tasks and settings as a JSON file for backup or migration.</p>
                    <div style="background: rgba(0, 99, 255, 0.08); padding: 15px; border-radius: 4px; margin-bottom: 15px;">
                        <p style="font-size: 0.85rem; margin-bottom: 10px;"><strong>üì¶ Available Data:</strong></p>
                        <ul style="list-style: none; padding: 0; font-size: 0.8rem; line-height: 1.8;">
                            <li>‚úì All 9 modules (tasks, priorities, estimates)</li>
                            <li>‚úì Notes and subtasks</li>
                            <li>‚úì Recurring task configuration</li>
                            <li>‚úì Creation dates and timestamps</li>
                            <li>‚úì Theme preference</li>
                        </ul>
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-btn download" onclick="exportDataAsJSON()">‚¨áÔ∏è DOWNLOAD BACKUP</button>
                        <button class="modal-btn" onclick="copyDataToClipboard()">üìã COPY JSON</button>
                    </div>
                </div>

                <!-- Import Tab -->
                <div id="syncTab-import" class="sync-tab-content" style="display: none;">
                    <h4 style="color: var(--primary); margin-bottom: 15px;">üì§ IMPORT YOUR DATA</h4>
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">Restore tasks from a previously exported JSON file.</p>
                    <div style="background: rgba(255, 170, 0, 0.1); padding: 15px; border-radius: 4px; margin-bottom: 15px; border: 1px solid rgba(255, 170, 0, 0.3);">
                        <p style="font-size: 0.8rem; color: var(--warning);"><strong>‚ö†Ô∏è WARNING:</strong> Importing will merge with existing data. Back up first!</p>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label for="importJSON" style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--primary);">Paste your JSON data:</label>
                        <textarea id="importJSON" aria-label="Paste exported JSON data" aria-describedby="importJSONHelper" style="width: 100%; height: 200px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 10px; border-radius: 4px; font-family: 'Space Mono', monospace; font-size: 0.75rem; resize: vertical;"></textarea>
                        <small id="importJSONHelper" style="display: block; margin-top: 5px; color: var(--text-secondary); font-size: 0.75rem;">Paste complete JSON from exported backup file</small>
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-btn" onclick="importDataFromJSON()">‚úì IMPORT DATA</button>
                        <button class="modal-btn" onclick="clearImportField()">üóëÔ∏è CLEAR</button>
                    </div>
                </div>

                <!-- GitHub Tab -->
                <div id="syncTab-github" class="sync-tab-content" style="display: none;">
                    <h4 style="color: var(--primary); margin-bottom: 15px;">üêô GITHUB ISSUES INTEGRATION</h4>
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">Export your tasks as GitHub Issues for collaborative tracking.</p>

                    <div style="background: rgba(0, 99, 255, 0.08); padding: 15px; border-radius: 4px; margin-bottom: 15px;">
                        <p style="font-size: 0.85rem; margin-bottom: 10px;"><strong>üìã How it works:</strong></p>
                        <ol style="font-size: 0.8rem; line-height: 1.8; padding-left: 20px;">
                            <li>Copy your GitHub Personal Access Token (ghp_*)</li>
                            <li>Enter repo in format: username/repository</li>
                            <li>Select which tasks to export</li>
                            <li>Issues created with priority labels and estimates</li>
                        </ol>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="githubToken" style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary);">GitHub Token:</label>
                        <input type="password" id="githubToken" placeholder="ghp_XXXXXXXXXXXX" aria-label="GitHub Personal Access Token" aria-describedby="tokenHelper" style="width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px; border-radius: 4px; font-family: 'Space Mono', monospace;" />
                        <small id="tokenHelper" style="display: block; margin-top: 4px; color: var(--text-secondary); font-size: 0.75rem;">Create token at github.com/settings/tokens with repo permissions</small>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label for="githubRepo" style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary);">Repository:</label>
                        <input type="text" id="githubRepo" placeholder="username/repository" aria-label="GitHub repository in format username/repository" aria-describedby="repoHelper" style="width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 212, 255, 0.3); color: var(--text-primary); padding: 8px; border-radius: 4px; font-family: 'Space Mono', monospace;" />
                        <small id="repoHelper" style="display: block; margin-top: 4px; color: var(--text-secondary); font-size: 0.75rem;">Format: username/repository-name</small>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary);">Export Options:</label>
                        <div style="display: flex; gap: 15px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem;">
                                <input type="checkbox" id="gh-only-pending" checked /> Only pending tasks
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem;">
                                <input type="checkbox" id="gh-high-priority" /> High priority only
                            </label>
                        </div>
                    </div>

                    <div class="modal-buttons">
                        <button class="modal-btn download" onclick="exportToGitHubIssues()">üöÄ EXPORT TO GITHUB</button>
                        <button class="modal-btn" onclick="validateGitHubCredentials()">‚úì TEST CONNECTION</button>
                    </div>
                </div>

                <div class="modal-buttons" style="margin-top: 20px; border-top: 1px solid rgba(0, 212, 255, 0.2); padding-top: 15px;">
                    <button class="modal-btn" onclick="closeSyncModal()">CLOSE</button>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle" onclick="if(event.target === this) closeHelpModal()">
            <div class="modal-content" style="max-width: 900px; max-height: 85vh;">
                <div class="modal-header">
                    <div class="modal-title" id="helpModalTitle">‚ùì HELP & REFERENCE</div>
                    <button class="modal-close" onclick="closeHelpModal()" aria-label="Close help dialog">‚úï</button>
                </div>

                <div class="help-tabs" style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid rgba(0, 212, 255, 0.2); padding-bottom: 15px; overflow-x: auto;">
                    <button onclick="showHelpTab('quickstart')" id="help-tab-quickstart" class="help-tab-btn active">üöÄ QUICK START</button>
                    <button onclick="showHelpTab('features')" id="help-tab-features" class="help-tab-btn">‚ú® FEATURES</button>
                    <button onclick="showHelpTab('shortcuts')" id="help-tab-shortcuts" class="help-tab-btn">‚å®Ô∏è SHORTCUTS</button>
                    <button onclick="showHelpTab('urlparams')" id="help-tab-urlparams" class="help-tab-btn">üîó URL PARAMS</button>
                    <button onclick="showHelpTab('tips')" id="help-tab-tips" class="help-tab-btn">üí° TIPS</button>
                    <button onclick="showHelpTab('faq')" id="help-tab-faq" class="help-tab-btn">‚ùì FAQ</button>
                </div>

                <div id="helpContent" style="overflow-y: auto; height: 500px; padding: 20px; background: rgba(0, 99, 255, 0.08); border-radius: 4px; margin-bottom: 20px;">
                    <!-- Quick Start Tab -->
                    <div id="help-quickstart" class="help-tab-content">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üöÄ Getting Started</h3>
                        <ol style="line-height: 2; color: var(--text-primary); font-size: 0.95rem;">
                            <li><strong>View Dashboard:</strong> See all 9 life domains at a glance with progress indicators</li>
                            <li><strong>Click a Module:</strong> Enter detail view to see and manage tasks</li>
                            <li><strong>Add a Task:</strong> Enter task description, select priority (High/Medium/Low), set time estimate in hours</li>
                            <li><strong>Complete Tasks:</strong> Click checkboxes to mark tasks complete and track progress</li>
                            <li><strong>Use Filters:</strong> View All tasks, Today's tasks, This Week, or High Priority only</li>
                            <li><strong>Track Progress:</strong> Watch the circular progress bar update as you complete tasks</li>
                        </ol>
                    </div>

                    <!-- Features Tab -->
                    <div id="help-features" class="help-tab-content" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">‚ú® Features Overview</h3>
                        <div style="display: grid; gap: 15px;">
                            <div style="border-left: 3px solid var(--primary); padding-left: 15px;">
                                <strong style="color: var(--primary);">üìä Global Statistics</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px; font-size: 0.9rem;">View overall completion rate, total hours, and high-priority task progress across all modules</p>
                            </div>
                            <div style="border-left: 3px solid var(--success); padding-left: 15px;">
                                <strong style="color: var(--success);">üéØ Smart Filtering</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px; font-size: 0.9rem;">Filter by All, Today, This Week, or High Priority to focus on what matters most</p>
                            </div>
                            <div style="border-left: 3px solid var(--warning); padding-left: 15px;">
                                <strong style="color: var(--warning);">üìù Notes & Subtasks</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px; font-size: 0.9rem;">Add detailed notes and break tasks into subtasks for better organization</p>
                            </div>
                            <div style="border-left: 3px solid var(--accent); padding-left: 15px;">
                                <strong style="color: var(--accent);">üîÅ Recurring Tasks</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px; font-size: 0.9rem;">Set tasks to repeat daily, weekly, or monthly automatically</p>
                            </div>
                            <div style="border-left: 3px solid #00ff88; padding-left: 15px;">
                                <strong style="color: #00ff88;">‚Ü©Ô∏è Undo/Redo</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px; font-size: 0.9rem;">Revert or replay actions with keyboard shortcuts or header buttons</p>
                            </div>
                            <div style="border-left: 3px solid #0099ff; padding-left: 15px;">
                                <strong style="color: #0099ff;">üì• Export & Import</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px; font-size: 0.9rem;">Backup your data or restore from exports through the Sync Center</p>
                            </div>
                            <div style="border-left: 3px solid #ff006e; padding-left: 15px;">
                                <strong style="color: #ff006e);">üé® Dark/Light Theme</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px; font-size: 0.9rem;">Toggle between dark and light themes to suit your preference</p>
                            </div>
                        </div>
                    </div>

                    <!-- Keyboard Shortcuts Tab -->
                    <div id="help-shortcuts" class="help-tab-content" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">‚å®Ô∏è Keyboard Shortcuts</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                            <div style="border: 1px solid rgba(0, 212, 255, 0.2); padding: 12px; border-radius: 4px;">
                                <div style="color: var(--primary); font-weight: 600; margin-bottom: 8px;">‚èÆÔ∏è Undo</div>
                                <code style="background: rgba(0, 0, 0, 0.3); padding: 4px 8px; border-radius: 3px; color: var(--text-primary);">Cmd+Z</code> or <code style="background: rgba(0, 0, 0, 0.3); padding: 4px 8px; border-radius: 3px; color: var(--text-primary);">Ctrl+Z</code>
                            </div>
                            <div style="border: 1px solid rgba(0, 212, 255, 0.2); padding: 12px; border-radius: 4px;">
                                <div style="color: var(--primary); font-weight: 600; margin-bottom: 8px;">‚è≠Ô∏è Redo</div>
                                <code style="background: rgba(0, 0, 0, 0.3); padding: 4px 8px; border-radius: 3px; color: var(--text-primary);">Cmd+Shift+Z</code> or <code style="background: rgba(0, 0, 0, 0.3); padding: 4px 8px; border-radius: 3px; color: var(--text-primary);">Ctrl+Shift+Z</code>
                            </div>
                            <div style="border: 1px solid rgba(0, 212, 255, 0.2); padding: 12px; border-radius: 4px;">
                                <div style="color: var(--primary); font-weight: 600; margin-bottom: 8px;">üîÑ Redo (Alt)</div>
                                <code style="background: rgba(0, 0, 0, 0.3); padding: 4px 8px; border-radius: 3px; color: var(--text-primary);">Cmd+Y</code> or <code style="background: rgba(0, 0, 0, 0.3); padding: 4px 8px; border-radius: 3px; color: var(--text-primary);">Ctrl+Y</code>
                            </div>
                            <div style="border: 1px solid rgba(0, 212, 255, 0.2); padding: 12px; border-radius: 4px;">
                                <div style="color: var(--primary); font-weight: 600; margin-bottom: 8px;">‚ùì Help</div>
                                <code style="background: rgba(0, 0, 0, 0.3); padding: 4px 8px; border-radius: 3px; color: var(--text-primary);">Cmd+?</code> or <code style="background: rgba(0, 0, 0, 0.3); padding: 4px 8px; border-radius: 3px; color: var(--text-primary);">Ctrl+?</code>
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); margin-top: 15px; font-size: 0.85rem;">More shortcuts coming in next update!</p>
                    </div>

                    <!-- URL Parameters Tab -->
                    <div id="help-urlparams" class="help-tab-content" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üîó URL Parameters (Bookmarking)</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">You can customize your view by adding parameters to the URL:</p>
                        <div style="display: grid; gap: 12px; font-size: 0.85rem;">
                            <div style="background: rgba(0, 99, 255, 0.1); padding: 12px; border-radius: 4px; border-left: 3px solid var(--primary);">
                                <strong style="color: var(--primary);">?module=afr</strong>
                                <p style="color: var(--text-secondary); margin-top: 4px;">Load specific module (afr, uxr, home, family, teaching, service, bellon, oak, health)</p>
                            </div>
                            <div style="background: rgba(0, 99, 255, 0.1); padding: 12px; border-radius: 4px; border-left: 3px solid var(--secondary);">
                                <strong style="color: var(--secondary);">?filter=today</strong>
                                <p style="color: var(--text-secondary); margin-top: 4px;">Set filter (all, today, week, priority)</p>
                            </div>
                            <div style="background: rgba(0, 99, 255, 0.1); padding: 12px; border-radius: 4px; border-left: 3px solid var(--accent);">
                                <strong style="color: var(--accent);">?theme=light</strong>
                                <p style="color: var(--text-secondary); margin-top: 4px;">Set theme (dark or light)</p>
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); margin-top: 15px; font-size: 0.85rem; background: rgba(255, 170, 0, 0.1); padding: 12px; border-radius: 4px; border-left: 3px solid var(--warning);">üí° <strong>Pro Tip:</strong> Bookmark URLs to quickly jump to your favorite views!</p>
                    </div>

                    <!-- Tips Tab -->
                    <div id="help-tips" class="help-tab-content" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üí° Pro Tips</h3>
                        <ol style="line-height: 2.2; color: var(--text-primary); font-size: 0.9rem;">
                            <li><strong>Priority Matters:</strong> Use High priority strategically for truly important tasks only</li>
                            <li><strong>Time Estimates:</strong> Be realistic with hours‚Äîthis helps you assess workload capacity</li>
                            <li><strong>Daily Review:</strong> Check the "Today" filter each morning to stay focused</li>
                            <li><strong>Recurring Tasks:</strong> Set up weekly or monthly recurring tasks for routine work</li>
                            <li><strong>Notes for Context:</strong> Add details in task notes to remember why it matters</li>
                            <li><strong>Subtasks for Complexity:</strong> Break large tasks into subtasks for better progress tracking</li>
                            <li><strong>Undo Liberally:</strong> Don't fear mistakes‚Äîundo/redo is always available</li>
                            <li><strong>Backup Regularly:</strong> Export your data monthly for safety</li>
                            <li><strong>Bookmark Workflows:</strong> Save URLs for your common work patterns (e.g., ?module=home&filter=today)</li>
                            <li><strong>Dark Theme:</strong> Use light theme during day, dark theme for evening work</li>
                        </ol>
                    </div>

                    <!-- FAQ Tab -->
                    <div id="help-faq" class="help-tab-content" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">‚ùì Frequently Asked Questions</h3>
                        <div style="display: grid; gap: 15px;">
                            <div>
                                <strong style="color: var(--primary);">Where is my data stored?</strong>
                                <p style="color: var(--text-secondary); margin-top: 8px; font-size: 0.9rem;">All data is stored locally in your browser's localStorage. It never leaves your device unless you export it.</p>
                            </div>
                            <div>
                                <strong style="color: var(--primary);">Can I use this offline?</strong>
                                <p style="color: var(--text-secondary); margin-top: 8px; font-size: 0.9rem;">Yes! Once loaded, Life OS works completely offline. Create, edit, and manage tasks without internet.</p>
                            </div>
                            <div>
                                <strong style="color: var(--primary);">How do I backup my data?</strong>
                                <p style="color: var(--text-secondary); margin-top: 8px; font-size: 0.9rem;">Click the ‚öôÔ∏è icon to open Sync Center, then use the Export tab to download your data as JSON.</p>
                            </div>
                            <div>
                                <strong style="color: var(--primary);">Can I sync across devices?</strong>
                                <p style="color: var(--text-secondary); margin-top: 8px; font-size: 0.9rem;">Currently you can export/import manually. Cloud sync is planned for a future release.</p>
                            </div>
                            <div>
                                <strong style="color: var(--primary);">What happens if I clear browser cache?</strong>
                                <p style="color: var(--text-secondary); margin-top: 8px; font-size: 0.9rem;">Your data will be lost. Always export first if clearing cache. Consider enabling browser data protection.</p>
                            </div>
                            <div>
                                <strong style="color: var(--primary);">Can I edit the modules/domains?</strong>
                                <p style="color: var(--text-secondary); margin-top: 8px; font-size: 0.9rem;">Currently the 9 domains are fixed, but you can customize the application by editing index.html directly.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button class="modal-btn" onclick="closeHelpModal()">CLOSE</button>
                </div>
            </div>
        </div>

        <!-- First-Time User Onboarding Banner -->
        <div id="onboardingBanner" class="onboarding-banner" style="display: none;">
            <div class="onboarding-content">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 2rem;">üéâ</div>
                    <div>
                        <div style="font-weight: 700; color: var(--primary); font-size: 1.05rem; margin-bottom: 4px;">Welcome to Life OS!</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Your command center for managing all life domains. Need help? Click the ‚ùì icon or press Cmd+?</div>
                    </div>
                </div>
                <button class="onboarding-close" onclick="dismissOnboardingBanner()" aria-label="Dismiss onboarding banner" style="background: transparent; border: none; color: var(--text-secondary); cursor: pointer; font-size: 1.3rem; padding: 0; opacity: 0.7; transition: opacity 0.2s;">‚úï</button>
            </div>
        </div>

        <footer>
            üíæ LOCAL PERSISTENT STORAGE // ‚ö° OFFLINE CAPABLE // üì± FULLY RESPONSIVE<br>
            LIFE OS v2.0 // COMMAND CENTER MODE // ALL SYSTEMS NOMINAL
        </footer>
    </div>

    <script>
        const STORAGE_KEYS = {
            afr: 'life-os-afr-tasks',
            uxr: 'life-os-uxr-tasks',
            domains: 'life-os-domain-items'
        };

        // ============================================
        // STORAGE VALIDATION & ERROR HANDLING UTILITIES
        // ============================================

        /**
         * Check if localStorage is available and functional
         * @returns {boolean} True if localStorage is available
         */
        function isStorageAvailable() {
            try {
                const test = '__localStorage_test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch(e) {
                console.error('localStorage is not available:', e);
                return false;
            }
        }

        /**
         * Validate task data structure
         * @param {object} task - Task object to validate
         * @returns {boolean} True if task has valid structure
         */
        function isValidTask(task) {
            if (!task || typeof task !== 'object') return false;

            // Check required fields
            if (typeof task.label !== 'string' || !task.label.trim()) return false;
            if (typeof task.completed !== 'boolean') return false;
            if (typeof task.priority !== 'string') return false;
            if (!['high', 'medium', 'low'].includes(task.priority)) return false;
            if (typeof task.estimate !== 'number' || task.estimate < 0) return false;
            if (typeof task.createdAt !== 'number' || task.createdAt < 0) return false;

            // Optional fields validation
            if (task.recurrence && !['none', 'daily', 'weekly', 'monthly'].includes(task.recurrence)) return false;
            if (task.notes && typeof task.notes !== 'string') return false;
            if (task.subtasks && !Array.isArray(task.subtasks)) return false;
            if (task.dueDate && typeof task.dueDate !== 'number') return false;

            return true;
        }

        /**
         * Sanitize and repair corrupted task data
         * @param {object} task - Potentially corrupted task
         * @returns {object} Repaired task object
         */
        function repairTaskData(task) {
            if (typeof task !== 'object' || !task) {
                return null;
            }

            // If it's just a boolean (legacy format), skip it
            if (typeof task === 'boolean') {
                return null;
            }

            const repaired = {
                label: (typeof task.label === 'string' && task.label.trim()) ? task.label : 'TASK',
                completed: typeof task.completed === 'boolean' ? task.completed : false,
                priority: ['high', 'medium', 'low'].includes(task.priority) ? task.priority : 'medium',
                estimate: (typeof task.estimate === 'number' && task.estimate >= 0) ? task.estimate : 1,
                createdAt: (typeof task.createdAt === 'number' && task.createdAt > 0) ? task.createdAt : Date.now(),
                dueDate: (typeof task.dueDate === 'number' && task.dueDate > 0) ? task.dueDate : Date.now(),
                recurrence: (task.recurrence && ['daily', 'weekly', 'monthly'].includes(task.recurrence)) ? task.recurrence : 'none'
            };

            // Preserve optional fields if valid
            if (typeof task.notes === 'string') {
                repaired.notes = task.notes;
            }
            if (Array.isArray(task.subtasks)) {
                repaired.subtasks = task.subtasks.filter(st =>
                    st && typeof st === 'object' && typeof st.label === 'string'
                );
            }

            return repaired;
        }

        /**
         * Safe localStorage retrieval with error handling and validation
         * @param {string} key - Storage key
         * @returns {object} Parsed and validated data, or empty object if unavailable
         */
        function getStorageData(key) {
            try {
                if (!isStorageAvailable()) {
                    console.warn('localStorage not available, returning empty data');
                    return {};
                }

                const data = localStorage.getItem(key);
                if (!data) {
                    return {};
                }

                let parsed;
                try {
                    parsed = JSON.parse(data);
                } catch(e) {
                    console.error(`Failed to parse data for key "${key}":`, e);
                    // Clear corrupted data
                    try {
                        localStorage.removeItem(key);
                    } catch(clearError) {
                        console.error('Failed to clear corrupted data:', clearError);
                    }
                    return {};
                }

                // Validate and repair task data
                if (typeof parsed === 'object' && parsed !== null && !Array.isArray(parsed)) {
                    const validated = {};
                    let repairsNeeded = false;

                    for (const [taskId, taskData] of Object.entries(parsed)) {
                        if (isValidTask(taskData)) {
                            validated[taskId] = taskData;
                        } else {
                            const repaired = repairTaskData(taskData);
                            if (repaired) {
                                validated[taskId] = repaired;
                                repairsNeeded = true;
                            }
                        }
                    }

                    // Save repaired data back to storage
                    if (repairsNeeded) {
                        try {
                            localStorage.setItem(key, JSON.stringify(validated));
                            console.warn(`Repaired corrupted data for key "${key}"`);
                        } catch(saveError) {
                            console.error('Failed to save repaired data:', saveError);
                        }
                    }

                    return validated;
                }

                return {};
            } catch(error) {
                console.error(`Error retrieving storage data for key "${key}":`, error);
                return {};
            }
        }

        /**
         * Safe localStorage setting with quota and error handling
         * @param {string} key - Storage key
         * @param {object} data - Data to store
         * @returns {boolean} True if storage was successful
         */
        function setStorageData(key, data) {
            try {
                if (!isStorageAvailable()) {
                    console.warn('localStorage not available, cannot save data');
                    return false;
                }

                const jsonString = JSON.stringify(data);

                // Check if data is too large (rough estimate)
                if (jsonString.length > 5 * 1024 * 1024) {
                    console.error('Data exceeds storage limit (5MB)');
                    return false;
                }

                localStorage.setItem(key, jsonString);
                return true;
            } catch(error) {
                if (error.name === 'QuotaExceededError' || error.message.includes('quota')) {
                    console.error(`Storage quota exceeded for key "${key}"`);
                    // Could implement cleanup strategy here (e.g., remove old data)
                } else {
                    console.error(`Error saving storage data for key "${key}":`, error);
                }
                return false;
            }
        }

        /**
         * Validate all storage data across all modules
         * @returns {object} Validation report with counts of issues found
         */
        function validateAllStorage() {
            const report = {
                modulesChecked: 0,
                tasksValidated: 0,
                tasksCorrected: 0,
                errors: []
            };

            modules.forEach(module => {
                report.modulesChecked++;
                const data = getStorageData(module.storageKey);
                const taskCount = Object.keys(data).length;
                report.tasksValidated += taskCount;
            });

            return report;
        }

        // ============================================
        // URL PARAMETER UTILITIES
        // ============================================

        /**
         * Parse URL parameters into an object
         * @returns {object} Parsed URL parameters
         */
        function getURLParameters() {
            const params = {};
            const queryString = window.location.search.substring(1);

            if (queryString) {
                const pairs = queryString.split('&');
                pairs.forEach(pair => {
                    const [key, value] = pair.split('=');
                    if (key) {
                        params[decodeURIComponent(key)] = value ? decodeURIComponent(value) : '';
                    }
                });
            }

            return params;
        }

        /**
         * Update URL without reloading page
         * @param {object} params - Parameters to set in URL
         */
        function updateURL(params) {
            try {
                const queryString = Object.keys(params)
                    .filter(key => params[key])
                    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                    .join('&');

                const url = queryString ? `${window.location.pathname}?${queryString}` : window.location.pathname;
                window.history.replaceState({}, '', url);
            } catch(error) {
                console.error('Error updating URL:', error);
            }
        }

        /**
         * Get a single URL parameter value
         * @param {string} key - Parameter key
         * @param {string} defaultValue - Default if not found
         * @returns {string} Parameter value
         */
        function getURLParam(key, defaultValue = '') {
            const params = getURLParameters();
            return params[key] || defaultValue;
        }

        // ============================================
        // USER & CREDENTIAL SYSTEM
        // ============================================

        /**
         * User and Credential Management
         * Scaffolded for multi-user support in future
         */
        const UserSystem = (() => {
            const STORAGE_KEY = 'life-os-current-user';
            const DEFAULT_USER = {
                id: 'default',
                name: 'Default User',
                credentialLevel: 'admin'  // 'admin' | 'editor' | 'viewer'
            };

            /**
             * Get current user from localStorage
             * @returns {object} Current user object
             */
            function getCurrentUser() {
                try {
                    const stored = localStorage.getItem(STORAGE_KEY);
                    if (stored) {
                        const user = JSON.parse(stored);
                        // Validate user has required fields
                        if (user.id && user.name && user.credentialLevel) {
                            return user;
                        }
                    }
                } catch(error) {
                    console.error('Error retrieving user:', error);
                }
                return { ...DEFAULT_USER };
            }

            /**
             * Set current user to localStorage
             * @param {object} user - User object to save
             * @returns {boolean} Success status
             */
            function setCurrentUser(user) {
                try {
                    if (!user.id || !user.name || !user.credentialLevel) {
                        console.error('Invalid user object');
                        return false;
                    }
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(user));
                    return true;
                } catch(error) {
                    console.error('Error saving user:', error);
                    return false;
                }
            }

            /**
             * Check if current user has permission for action
             * @param {string} action - Action to check ('read'|'edit'|'admin')
             * @returns {boolean} True if user has permission
             */
            function hasPermission(action) {
                const user = getCurrentUser();
                const credentialMap = {
                    'admin': ['read', 'edit', 'admin'],
                    'editor': ['read', 'edit'],
                    'viewer': ['read']
                };

                return credentialMap[user.credentialLevel]?.includes(action) || false;
            }

            return {
                getCurrentUser,
                setCurrentUser,
                hasPermission,
                DEFAULT_USER
            };
        })();

        // Initialize current user on page load
        let currentUser = UserSystem.getCurrentUser();

        const modules = [
            { id: 'afr', name: 'Annual Review', icon: 'üéØ', description: 'Faculty evaluation and self-assessment', storageKey: STORAGE_KEYS.afr, defaultTasks: ['COLLECT TEACHING EVALUATIONS', 'DOCUMENT SERVICE CONTRIBUTIONS', 'COMPILE RESEARCH ACTIVITIES', 'PROFESSIONAL DEVELOPMENT SUMMARY', 'SELF-EVALUATION NARRATIVE', 'GOAL SETTING FOR NEXT CYCLE'] },
            { id: 'uxr', name: 'UXR Lab', icon: 'üß™', description: 'User research projects and studies', storageKey: STORAGE_KEYS.uxr, defaultTasks: ['USER RESEARCH PLANNING', 'PARTICIPANT RECRUITMENT', 'CONDUCT INTERVIEWS', 'DATA ANALYSIS', 'FINDINGS DOCUMENTATION', 'PRESENT RESULTS'] },
            { id: 'home', name: 'Home', icon: 'üè†', description: 'Household management and operations', storageKey: 'home-domain', defaultTasks: [] },
            { id: 'family', name: 'Family', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', description: 'Family relationships and activities', storageKey: 'family-domain', defaultTasks: [] },
            { id: 'teaching', name: 'PFW Teaching', icon: 'üìö', description: 'Course development and engagement', storageKey: 'teaching-domain', defaultTasks: [] },
            { id: 'service', name: 'PFW Service', icon: 'üèõÔ∏è', description: 'University committees and obligations', storageKey: 'service-domain', defaultTasks: [] },
            { id: 'bellon', name: 'Bellon Branch', icon: 'üå≥', description: 'Branch operations and management', storageKey: 'bellon-domain', defaultTasks: [] },
            { id: 'oak', name: 'Olde Oak Tree', icon: 'üè°', description: 'Property and asset management', storageKey: 'oak-domain', defaultTasks: [] },
            { id: 'health', name: 'Health', icon: 'üí™', description: 'Personal wellness and fitness', storageKey: 'health-domain', defaultTasks: [] }
        ];

        // Undo/Redo State Manager
        const UndoRedoManager = (() => {
            let undoStack = [];
            let redoStack = [];
            const MAX_HISTORY = 50; // Limit history to 50 states

            return {
                saveState: function(description = 'Action') {
                    // Capture current state of all modules
                    const state = {};
                    modules.forEach(m => {
                        state[m.storageKey] = JSON.parse(localStorage.getItem(m.storageKey) || '{}');
                    });

                    undoStack.push({ state, description });
                    redoStack = []; // Clear redo stack when new action is taken

                    // Limit history size
                    if (undoStack.length > MAX_HISTORY) {
                        undoStack = undoStack.slice(undoStack.length - MAX_HISTORY);
                    }

                    updateUndoRedoButtons();
                },

                undo: function() {
                    if (undoStack.length === 0) return false;

                    // Save current state to redo stack
                    const currentState = {};
                    modules.forEach(m => {
                        currentState[m.storageKey] = JSON.parse(localStorage.getItem(m.storageKey) || '{}');
                    });
                    redoStack.push(currentState);

                    // Restore previous state
                    const previousState = undoStack.pop();
                    Object.entries(previousState.state).forEach(([key, data]) => {
                        localStorage.setItem(key, JSON.stringify(data));
                    });

                    updateUndoRedoButtons();
                    return true;
                },

                redo: function() {
                    if (redoStack.length === 0) return false;

                    // Save current state to undo stack
                    const currentState = {};
                    modules.forEach(m => {
                        currentState[m.storageKey] = JSON.parse(localStorage.getItem(m.storageKey) || '{}');
                    });
                    undoStack.push({ state: currentState });

                    // Restore redo state
                    const stateToRestore = redoStack.pop();
                    Object.entries(stateToRestore).forEach(([key, data]) => {
                        localStorage.setItem(key, JSON.stringify(data));
                    });

                    updateUndoRedoButtons();
                    return true;
                },

                canUndo: function() {
                    return undoStack.length > 0;
                },

                canRedo: function() {
                    return redoStack.length > 0;
                },

                clear: function() {
                    undoStack = [];
                    redoStack = [];
                    updateUndoRedoButtons();
                }
            };
        })();

        let currentModule = null;
        let currentFilter = 'all';

        function initializeDefaultTasks(module) {
            let tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
            if (Object.keys(tasks).length === 0 && module.defaultTasks.length > 0) {
                module.defaultTasks.forEach((task, index) => {
                    const taskId = module.id + '-' + index;
                    tasks[taskId] = {
                        completed: false,
                        priority: 'medium',
                        estimate: 2,
                        label: task,
                        createdAt: Date.now()
                    };
                });
                localStorage.setItem(module.storageKey, JSON.stringify(tasks));
            }
            return tasks;
        }

        function getModuleProgress(module) {
            const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
            const taskIds = Object.keys(tasks);
            const completed = taskIds.filter(id => {
                const task = tasks[id];
                return typeof task === 'object' ? task.completed : task;
            }).length;
            return { completed, total: taskIds.length };
        }

        function renderDashboard() {
            const grid = document.getElementById('moduleGrid');
            grid.innerHTML = '';

            modules.forEach(module => {
                const { completed, total } = getModuleProgress(module);
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

                const card = document.createElement('div');
                card.className = 'module-card';
                card.setAttribute('data-module-id', module.id);
                card.onclick = () => openModule(module);
                
                card.innerHTML = `
                    <div class="corner top-left"></div>
                    <div class="corner top-right"></div>
                    <div class="corner bottom-left"></div>
                    <div class="corner bottom-right"></div>

                    <div class="module-header">
                        <div class="module-title">
                            <span class="module-icon">${module.icon}</span>
                            ${module.name}
                        </div>
                    </div>

                    <div class="module-status">
                        <span><span class="status-count">${completed}</span>/${total}</span>
                    </div>

                    <div class="module-mini-progress">
                        <div class="module-mini-fill" style="width: ${percentage}%"></div>
                    </div>

                    <div class="module-description">
                        ${module.description}
                    </div>

                    <div class="module-action">
                        ENTER MODULE ‚Üí
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function openModule(module) {
            currentModule = module;
            currentFilter = 'all';  // Reset filter when opening module
            initializeDefaultTasks(module);

            document.getElementById('overviewView').classList.add('hidden-view');
            document.getElementById('detailView').classList.remove('hidden-view');

            document.getElementById('detailIcon').textContent = module.icon;
            document.getElementById('detailName').textContent = module.name;
            document.getElementById('detailInput').placeholder = `// add ${module.name.toLowerCase()} task...`;

            renderDetailView(module);

            // Update URL to reflect current module
            updateURL({
                module: module.id,
                filter: 'all',
                theme: localStorage.getItem('life-os-theme') || 'dark'
            });
        }

        function backToDashboard() {
            currentModule = null;
            document.getElementById('detailView').classList.add('hidden-view');
            document.getElementById('overviewView').classList.remove('hidden-view');

            // Update URL to clear module parameter
            updateURL({
                theme: localStorage.getItem('life-os-theme') || 'dark'
            });
        }

        function renderDetailView(module) {
            const tasks = getStorageData(module.storageKey);
            const taskIds = Object.keys(tasks);
            const completed = taskIds.filter(id => {
                const task = tasks[id];
                return typeof task === 'object' ? task.completed : task;
            }).length;
            const total = taskIds.length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('detailPercent').textContent = percentage;
            document.getElementById('detailComplete').textContent = completed;
            document.getElementById('detailTotal').textContent = total;

            const angle = (percentage / 100) * 360;
            document.getElementById('detailCircle').style.setProperty('--progress-angle', angle + 'deg');

            const checklist = document.getElementById('detailChecklist');
            checklist.innerHTML = '';

            if (taskIds.length === 0) {
                checklist.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px; font-style: italic;">NO TASKS INITIALIZED // ADD YOUR FIRST TASK BELOW</div>';
            } else {
                let filteredTasks = taskIds;
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());

                if (currentFilter === 'today') {
                    filteredTasks = taskIds.filter(id => {
                        const task = tasks[id];
                        if (typeof task === 'object' && task.createdAt) {
                            const taskDate = new Date(task.createdAt);
                            taskDate.setHours(0, 0, 0, 0);
                            return taskDate.getTime() === today.getTime();
                        }
                        return false;
                    });
                } else if (currentFilter === 'week') {
                    filteredTasks = taskIds.filter(id => {
                        const task = tasks[id];
                        if (typeof task === 'object' && task.createdAt) {
                            const taskDate = new Date(task.createdAt);
                            taskDate.setHours(0, 0, 0, 0);
                            return taskDate >= weekStart && taskDate <= today;
                        }
                        return false;
                    });
                } else if (currentFilter === 'high') {
                    filteredTasks = taskIds.filter(id => {
                        const task = tasks[id];
                        return typeof task === 'object' ? task.priority === 'high' : false;
                    });
                }

                if (filteredTasks.length === 0 && currentFilter !== 'all') {
                    checklist.innerHTML = `<div style="text-align: center; color: var(--text-secondary); padding: 20px; font-style: italic;">NO TASKS IN ${currentFilter.toUpperCase()} FILTER</div>`;
                } else {
                    filteredTasks.forEach(id => {
                        const taskData = tasks[id];
                        const isCompleted = typeof taskData === 'object' ? taskData.completed : taskData;
                        const priority = typeof taskData === 'object' ? taskData.priority : 'medium';
                        const estimate = typeof taskData === 'object' ? taskData.estimate : 0;
                        const label = typeof taskData === 'object' ? taskData.label : 'Task';
                        const recurrence = typeof taskData === 'object' ? taskData.recurrence : 'none';

                        const recurrenceEmoji = {
                            'daily': 'üìÖ',
                            'weekly': 'üìÜ',
                            'monthly': 'üìä',
                            'none': ''
                        }[recurrence] || '';

                        const item = document.createElement('div');
                        item.className = 'check-item';
                        item.innerHTML = `
                            <input type="checkbox" id="${id}" ${isCompleted ? 'checked' : ''} onchange="updateModuleProgress('${id}')">
                            <div style="flex: 1;">
                                <label for="${id}">${label}</label>
                                <div class="task-meta">
                                    <span class="meta-item"><span class="priority-indicator priority-${priority}"></span>${priority.toUpperCase()}</span>
                                    <span class="meta-item">‚è±Ô∏è ${estimate}h</span>
                                    ${recurrence !== 'none' ? `<span class="meta-item">${recurrenceEmoji} ${recurrence.toUpperCase()}</span>` : ''}
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="task-btn edit" onclick="openNotesModal('${id}')">NOTES</button>
                                <button class="task-btn edit" onclick="editTask('${id}')">EDIT</button>
                                <button class="task-btn delete" onclick="deleteTask('${id}')">DELETE</button>
                            </div>
                        `;
                        checklist.appendChild(item);
                    });
                }
            }
        }

        function getTaskLabel(id, module) {
            const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
            const task = tasks[id];
            if (typeof task === 'object') {
                return task.label || 'Task';
            }
            return task || 'Task';
        }

        function setFilter(filterType) {
            currentFilter = filterType;

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderDetailView(currentModule);

            // Update URL to reflect current filter
            if (currentModule) {
                updateURL({
                    module: currentModule.id,
                    filter: filterType,
                    theme: localStorage.getItem('life-os-theme') || 'dark'
                });
            }
        }

        function updateModuleProgress(changedTaskId) {
            if (!currentModule) return;

            try {
                const tasks = getStorageData(currentModule.storageKey);

                // Save state for undo/redo before making changes
                UndoRedoManager.saveState(`Task ${changedTaskId ? 'completed' : 'updated'}`);

                document.querySelectorAll('#detailChecklist input[type="checkbox"]').forEach(cb => {
                    if (tasks[cb.id]) {
                        const taskData = tasks[cb.id];
                        if (typeof taskData === 'object') {
                            taskData.completed = cb.checked;

                            // Handle recurring tasks - create next instance when checked
                            if (cb.checked && taskData.recurrence && taskData.recurrence !== 'none') {
                                const nextDate = new Date(taskData.dueDate || Date.now());
                                switch(taskData.recurrence) {
                                    case 'daily':
                                        nextDate.setDate(nextDate.getDate() + 1);
                                        break;
                                    case 'weekly':
                                        nextDate.setDate(nextDate.getDate() + 7);
                                        break;
                                    case 'monthly':
                                        nextDate.setMonth(nextDate.getMonth() + 1);
                                        break;
                                }

                                // Create new recurring task instance
                                const newId = currentModule.id + '-' + nextDate.getTime();
                                if (!tasks[newId]) {
                                    tasks[newId] = {
                                        completed: false,
                                        priority: taskData.priority,
                                        estimate: taskData.estimate,
                                        recurrence: taskData.recurrence,
                                        label: taskData.label,
                                        createdAt: nextDate.getTime(),
                                        dueDate: nextDate.getTime()
                                    };
                                }
                            }
                        } else {
                            tasks[cb.id] = cb.checked;
                        }
                    }
                });

                if (!setStorageData(currentModule.storageKey, tasks)) {
                    console.error('Failed to save task progress');
                    return;
                }

                renderDetailView(currentModule);
                renderDashboard();
                updateGlobalStats();
                updateUndoRedoButtons();
            } catch(error) {
                console.error('Error updating module progress:', error);
            }
        }

        function addDetailTask() {
            if (!currentModule) return;

            try {
                const input = document.getElementById('detailInput');
                const priority = document.getElementById('prioritySelect').value;
                const recurrence = document.getElementById('recurrenceSelect').value;
                const estimate = parseFloat(document.getElementById('estimateInput').value) || 1;
                const taskLabel = input.value.trim().toUpperCase();

                // Form validation
                if (!taskLabel) {
                    alert('TASK DESCRIPTION REQUIRED');
                    return;
                }

                if (taskLabel.length > 100) {
                    alert('TASK DESCRIPTION TOO LONG (MAX 100 CHARACTERS)');
                    return;
                }

                if (estimate < 0 || estimate > 1000) {
                    alert('TIME ESTIMATE MUST BE BETWEEN 0 AND 1000 HOURS');
                    return;
                }

                const tasks = getStorageData(currentModule.storageKey);

                // Save state for undo/redo before making changes
                UndoRedoManager.saveState(`Task created: "${taskLabel}"`);

                const id = currentModule.id + '-' + Date.now();
                tasks[id] = {
                    completed: false,
                    priority: priority,
                    estimate: estimate,
                    recurrence: recurrence,
                    label: taskLabel,
                    createdAt: Date.now(),
                    dueDate: Date.now()
                };

                if (!setStorageData(currentModule.storageKey, tasks)) {
                    alert('FAILED TO CREATE TASK // STORAGE FULL OR UNAVAILABLE');
                    return;
                }

                input.value = '';
                document.getElementById('estimateInput').value = '1';
                document.getElementById('prioritySelect').value = 'medium';
                document.getElementById('recurrenceSelect').value = 'none';
                renderDetailView(currentModule);
                renderDashboard();
                updateGlobalStats();
                updateUndoRedoButtons();
            } catch(error) {
                console.error('Error adding task:', error);
                alert('ERROR CREATING TASK // CHECK CONSOLE FOR DETAILS');
            }
        }

        function updateGlobalStats() {
            let totalTasks = 0;
            let completedTasks = 0;
            let totalHours = 0;
            let completedHours = 0;
            let highPriorityCount = 0;
            let highPriorityCompleted = 0;

            modules.forEach(module => {
                const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
                const taskIds = Object.keys(tasks);

                taskIds.forEach(id => {
                    const taskData = tasks[id];
                    if (typeof taskData === 'object') {
                        totalTasks++;
                        if (taskData.completed) completedTasks++;

                        const hours = taskData.estimate || 0;
                        totalHours += hours;
                        if (taskData.completed) completedHours += hours;

                        if (taskData.priority === 'high') {
                            highPriorityCount++;
                            if (taskData.completed) highPriorityCompleted++;
                        }
                    }
                });
            });

            const completionPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            const hoursPercent = totalHours > 0 ? Math.round((completedHours / totalHours) * 100) : 0;
            const highPriorityPercent = highPriorityCount > 0 ? Math.round((highPriorityCompleted / highPriorityCount) * 100) : 0;

            const statsGrid = document.getElementById('globalStatsGrid');
            const globalStats = document.getElementById('globalStats');

            if (totalTasks > 0) {
                globalStats.style.display = 'block';
                statsGrid.innerHTML = `
                    <div class="global-stat-box">
                        <span class="global-stat-value">${completedTasks}/${totalTasks}</span>
                        <span class="global-stat-label">TASKS COMPLETED</span>
                    </div>
                    <div class="global-stat-box">
                        <span class="global-stat-value">${completionPercent}%</span>
                        <span class="global-stat-label">COMPLETION RATE</span>
                    </div>
                    <div class="global-stat-box">
                        <span class="global-stat-value">${completedHours.toFixed(1)}h</span>
                        <span class="global-stat-label">HOURS COMPLETED</span>
                    </div>
                    <div class="global-stat-box">
                        <span class="global-stat-value">${totalHours.toFixed(1)}h</span>
                        <span class="global-stat-label">TOTAL HOURS</span>
                    </div>
                    <div class="global-stat-box">
                        <span class="global-stat-value">${highPriorityCompleted}/${highPriorityCount}</span>
                        <span class="global-stat-label">HIGH PRIORITY DONE</span>
                    </div>
                    <div class="global-stat-box">
                        <span class="global-stat-value">${hoursPercent}%</span>
                        <span class="global-stat-label">HOUR COMPLETION</span>
                    </div>
                `;
            } else {
                globalStats.style.display = 'none';
            }
        }

        function deleteTask(taskId) {
            if (!currentModule) return;

            if (!confirm('DELETE THIS TASK?')) {
                return;
            }

            try {
                const tasks = getStorageData(currentModule.storageKey);
                const taskLabel = typeof tasks[taskId] === 'object' ? tasks[taskId].label : 'Task';

                // Save state for undo/redo before making changes
                UndoRedoManager.saveState(`Task deleted: "${taskLabel}"`);

                delete tasks[taskId];

                if (!setStorageData(currentModule.storageKey, tasks)) {
                    console.error('Failed to save task deletion');
                    return;
                }

                renderDetailView(currentModule);
                renderDashboard();
                updateGlobalStats();
                updateUndoRedoButtons();
            } catch(error) {
                console.error('Error deleting task:', error);
            }
        }

        function editTask(taskId) {
            if (!currentModule) return;

            try {
                const tasks = getStorageData(currentModule.storageKey);
                const taskData = tasks[taskId];

                if (!taskData || typeof taskData !== 'object') {
                    alert('TASK NOT FOUND OR INVALID FORMAT');
                    return;
                }

                const newLabel = prompt('EDIT TASK DESCRIPTION:', taskData.label);
                if (newLabel === null) return;

                if (!newLabel.trim()) {
                    alert('TASK DESCRIPTION CANNOT BE EMPTY');
                    return;
                }

                if (newLabel.length > 100) {
                    alert('TASK DESCRIPTION TOO LONG (MAX 100 CHARACTERS)');
                    return;
                }

                const priorityOptions = 'Select priority:\n1. HIGH\n2. MEDIUM\n3. LOW\n\nEnter 1, 2, or 3:';
                const priorityInput = prompt(priorityOptions, '2');
                if (priorityInput === null) return;

                const priorityMap = { '1': 'high', '2': 'medium', '3': 'low' };
                const newPriority = priorityMap[priorityInput];

                if (!newPriority) {
                    alert('INVALID PRIORITY SELECTION');
                    return;
                }

                const estimateInput = prompt('EDIT TIME ESTIMATE (hours):', taskData.estimate);
                if (estimateInput === null) return;

                const newEstimate = parseFloat(estimateInput);
                if (isNaN(newEstimate) || newEstimate < 0 || newEstimate > 1000) {
                    alert('TIME ESTIMATE MUST BE BETWEEN 0 AND 1000 HOURS');
                    return;
                }

                const recurrenceOptions = 'Select recurrence:\n1. NONE\n2. DAILY\n3. WEEKLY\n4. MONTHLY\n\nEnter 1, 2, 3, or 4:';
                const recurrenceInput = prompt(recurrenceOptions, '1');
                if (recurrenceInput === null) return;

                const recurrenceMap = { '1': 'none', '2': 'daily', '3': 'weekly', '4': 'monthly' };
                const newRecurrence = recurrenceMap[recurrenceInput];

                if (!newRecurrence) {
                    alert('INVALID RECURRENCE SELECTION');
                    return;
                }

                // Save state for undo/redo before making changes
                UndoRedoManager.saveState(`Task edited: "${taskData.label}"`);

                taskData.label = newLabel.toUpperCase();
                taskData.priority = newPriority;
                taskData.estimate = newEstimate;
                taskData.recurrence = newRecurrence;

                tasks[taskId] = taskData;

                if (!setStorageData(currentModule.storageKey, tasks)) {
                    console.error('Failed to save task edits');
                    return;
                }

                renderDetailView(currentModule);
                renderDashboard();
                updateGlobalStats();
                updateUndoRedoButtons();
            } catch(error) {
                console.error('Error editing task:', error);
            }
        }

        function exportModuleMarkdown() {
            if (!currentModule) return;

            const tasks = JSON.parse(localStorage.getItem(currentModule.storageKey) || '{}');
            const taskIds = Object.keys(tasks);

            if (taskIds.length === 0) {
                alert('NO TASKS TO EXPORT IN THIS MODULE');
                return;
            }

            let markdown = `# ${currentModule.name}\n\n`;
            markdown += `**Module:** ${currentModule.name}\n`;
            markdown += `**Exported:** ${new Date().toLocaleString()}\n`;
            markdown += `**Total Tasks:** ${taskIds.length}\n\n`;

            const completed = taskIds.filter(id => {
                const task = tasks[id];
                return typeof task === 'object' ? task.completed : task;
            }).length;
            markdown += `**Completed:** ${completed}/${taskIds.length}\n\n`;

            markdown += '---\n\n';
            markdown += '## Tasks\n\n';

            taskIds.forEach((id, index) => {
                const taskData = tasks[id];
                const isCompleted = typeof taskData === 'object' ? taskData.completed : taskData;
                const priority = typeof taskData === 'object' ? taskData.priority : 'medium';
                const estimate = typeof taskData === 'object' ? taskData.estimate : 0;
                const label = typeof taskData === 'object' ? taskData.label : 'Task';

                const checkbox = isCompleted ? '[x]' : '[ ]';
                const priorityEmoji = priority === 'high' ? 'üî¥' : priority === 'low' ? 'üü¢' : 'üü†';
                const completionClass = isCompleted ? '~~' : '';

                markdown += `${index + 1}. ${checkbox} ${priorityEmoji} ${completionClass}${label}${completionClass}\n`;
                markdown += `   - **Priority:** ${priority.toUpperCase()} ${priorityEmoji}\n`;
                markdown += `   - **Estimate:** ${estimate} hours\n`;
                markdown += `   - **Status:** ${isCompleted ? 'COMPLETED ‚úÖ' : 'PENDING ‚è≥'}\n\n`;
            });

            markdown += '---\n\n';
            markdown += `*Generated by Life OS Command Center*\n`;
            markdown += `*https://jaydjohns.github.io/LifeOS_CommandCenter/*\n`;

            // Show modal with export content
            document.getElementById('exportTextarea').value = markdown;
            document.getElementById('exportModal').classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        function copyExportToClipboard() {
            const textarea = document.getElementById('exportTextarea');
            textarea.select();
            document.execCommand('copy');

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì COPIED';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        function downloadExportFile() {
            const textarea = document.getElementById('exportTextarea');
            const content = textarea.value;
            const filename = `${currentModule.id}-tasks-${new Date().toISOString().split('T')[0]}.md`;

            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        let currentDigestContent = '';
        let currentEditingTaskId = null;

        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                console.log('Notifications not supported');
                return;
            }

            if (Notification.permission === 'granted') {
                return;
            }

            if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification('Life OS Notifications', {
                            body: 'Notifications enabled! You will receive task alerts.',
                            icon: '‚ö°'
                        });
                    }
                });
            }
        }

        function sendTaskNotifications() {
            if (!('Notification' in window)) {
                alert('YOUR BROWSER DOES NOT SUPPORT NOTIFICATIONS');
                return;
            }

            if (Notification.permission === 'denied') {
                alert('NOTIFICATIONS ARE BLOCKED. PLEASE ENABLE THEM IN YOUR BROWSER SETTINGS.');
                return;
            }

            if (Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        sendTaskNotifications();
                    }
                });
                return;
            }

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let highPriorityTasks = [];
            let dueTodayTasks = [];
            let overdueTasks = [];
            let completionStats = { total: 0, completed: 0 };

            modules.forEach(module => {
                const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
                const taskIds = Object.keys(tasks);

                taskIds.forEach(id => {
                    const taskData = tasks[id];
                    if (typeof taskData === 'object') {
                        completionStats.total++;
                        if (taskData.completed) {
                            completionStats.completed++;
                        }

                        if (!taskData.completed) {
                            const taskDate = new Date(taskData.createdAt || 0);
                            taskDate.setHours(0, 0, 0, 0);

                            if (taskData.priority === 'high') {
                                highPriorityTasks.push({
                                    label: taskData.label,
                                    module: module.name,
                                    priority: 'HIGH'
                                });
                            }

                            if (taskDate.getTime() === today.getTime()) {
                                dueTodayTasks.push({
                                    label: taskData.label,
                                    module: module.name,
                                    priority: taskData.priority
                                });
                            }

                            if (taskDate < today) {
                                overdueTasks.push({
                                    label: taskData.label,
                                    module: module.name,
                                    priority: taskData.priority,
                                    daysOverdue: Math.floor((today - taskDate) / (1000 * 60 * 60 * 24))
                                });
                            }
                        }
                    }
                });
            });

            let notificationSent = false;

            if (highPriorityTasks.length > 0) {
                const count = highPriorityTasks.length;
                new Notification('üî¥ HIGH PRIORITY TASKS', {
                    body: `You have ${count} high priority task${count !== 1 ? 's' : ''} pending attention.`,
                    tag: 'high-priority',
                    requireInteraction: true
                });
                notificationSent = true;
            }

            if (overdueTasks.length > 0) {
                const count = overdueTasks.length;
                new Notification('‚ö†Ô∏è OVERDUE TASKS', {
                    body: `You have ${count} overdue task${count !== 1 ? 's' : ''}. Time to catch up!`,
                    tag: 'overdue',
                    requireInteraction: true
                });
                notificationSent = true;
            }

            if (dueTodayTasks.length > 0) {
                const count = dueTodayTasks.length;
                new Notification('üìÖ TODAY\'S TASKS', {
                    body: `You have ${count} task${count !== 1 ? 's' : ''} to complete today.`,
                    tag: 'today'
                });
                notificationSent = true;
            }

            if (completionStats.total > 0) {
                const completionRate = Math.round((completionStats.completed / completionStats.total) * 100);
                new Notification('üìä COMPLETION STATUS', {
                    body: `Overall completion: ${completionStats.completed}/${completionStats.total} (${completionRate}%)`,
                    tag: 'status'
                });
                notificationSent = true;
            }

            if (!notificationSent) {
                new Notification('‚úÖ ALL CAUGHT UP!', {
                    body: 'You have no pending or overdue tasks. Great job!'
                });
            }
        }

        function generateWeeklyDigest() {
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);

            let digestHTML = '';
            digestHTML += `<h3 style="color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid rgba(0, 212, 255, 0.3); padding-bottom: 10px;">WEEKLY DIGEST REPORT</h3>`;
            digestHTML += `<p style="margin-bottom: 20px;"><strong>Week of:</strong> ${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}</p>`;
            digestHTML += `<p style="margin-bottom: 20px;"><strong>Generated:</strong> ${new Date().toLocaleString()}</p>`;

            let totalTasksCompleted = 0;
            let totalTasksAssigned = 0;
            let totalHoursCompleted = 0;
            let totalHoursAssigned = 0;
            let highPriorityCompleted = 0;
            let highPriorityAssigned = 0;
            let moduleBreakdown = [];

            modules.forEach(module => {
                const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
                const taskIds = Object.keys(tasks);

                let moduleCompleted = 0;
                let moduleAssigned = 0;
                let moduleHoursCompleted = 0;
                let moduleHoursAssigned = 0;
                let moduleHighPriority = 0;
                let moduleHighPriorityCompleted = 0;
                let taskDetails = [];

                taskIds.forEach(id => {
                    const taskData = tasks[id];
                    if (typeof taskData === 'object') {
                        const createdDate = new Date(taskData.createdAt || 0);
                        createdDate.setHours(0, 0, 0, 0);

                        const isThisWeek = createdDate >= weekStart && createdDate <= weekEnd;
                        const isCompleted = taskData.completed || false;
                        const priority = taskData.priority || 'medium';
                        const estimate = taskData.estimate || 0;

                        if (isThisWeek) {
                            moduleAssigned++;
                            totalTasksAssigned++;
                            moduleHoursAssigned += estimate;
                            totalHoursAssigned += estimate;

                            if (priority === 'high') {
                                moduleHighPriority++;
                                highPriorityAssigned++;
                            }

                            if (isCompleted) {
                                moduleCompleted++;
                                totalTasksCompleted++;
                                moduleHoursCompleted += estimate;
                                totalHoursCompleted += estimate;

                                if (priority === 'high') {
                                    moduleHighPriorityCompleted++;
                                    highPriorityCompleted++;
                                }
                            }

                            const statusEmoji = isCompleted ? '‚úÖ' : '‚è≥';
                            const priorityEmoji = priority === 'high' ? 'üî¥' : priority === 'low' ? 'üü¢' : 'üü†';
                            taskDetails.push({
                                label: taskData.label,
                                priority: priority,
                                estimate: estimate,
                                completed: isCompleted,
                                statusEmoji: statusEmoji,
                                priorityEmoji: priorityEmoji
                            });
                        }
                    }
                });

                if (moduleAssigned > 0) {
                    const moduleCompletion = Math.round((moduleCompleted / moduleAssigned) * 100);
                    moduleBreakdown.push({
                        name: module.name,
                        icon: module.icon,
                        assigned: moduleAssigned,
                        completed: moduleCompleted,
                        completion: moduleCompletion,
                        hoursAssigned: moduleHoursAssigned,
                        hoursCompleted: moduleHoursCompleted,
                        highPriority: moduleHighPriority,
                        highPriorityCompleted: moduleHighPriorityCompleted,
                        tasks: taskDetails
                    });
                }
            });

            // Summary Stats
            digestHTML += `<h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid rgba(0, 212, 255, 0.3); padding-bottom: 10px;">WEEKLY SUMMARY</h3>`;
            digestHTML += `<table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">`;
            digestHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            digestHTML += `<td style="padding: 10px; text-align: left;"><strong>Total Tasks Assigned:</strong></td>`;
            digestHTML += `<td style="padding: 10px; text-align: right; color: var(--primary);">${totalTasksAssigned}</td>`;
            digestHTML += `</tr>`;
            digestHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            digestHTML += `<td style="padding: 10px; text-align: left;"><strong>Tasks Completed:</strong></td>`;
            digestHTML += `<td style="padding: 10px; text-align: right; color: var(--success);">${totalTasksCompleted}</td>`;
            digestHTML += `</tr>`;
            const taskCompletion = totalTasksAssigned > 0 ? Math.round((totalTasksCompleted / totalTasksAssigned) * 100) : 0;
            digestHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            digestHTML += `<td style="padding: 10px; text-align: left;"><strong>Completion Rate:</strong></td>`;
            digestHTML += `<td style="padding: 10px; text-align: right; color: var(--primary);">${taskCompletion}%</td>`;
            digestHTML += `</tr>`;
            digestHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            digestHTML += `<td style="padding: 10px; text-align: left;"><strong>Hours Assigned:</strong></td>`;
            digestHTML += `<td style="padding: 10px; text-align: right; color: var(--primary);">${totalHoursAssigned.toFixed(1)}h</td>`;
            digestHTML += `</tr>`;
            digestHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            digestHTML += `<td style="padding: 10px; text-align: left;"><strong>Hours Completed:</strong></td>`;
            digestHTML += `<td style="padding: 10px; text-align: right; color: var(--success);">${totalHoursCompleted.toFixed(1)}h</td>`;
            digestHTML += `</tr>`;
            const hourCompletion = totalHoursAssigned > 0 ? Math.round((totalHoursCompleted / totalHoursAssigned) * 100) : 0;
            digestHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            digestHTML += `<td style="padding: 10px; text-align: left;"><strong>Hour Completion Rate:</strong></td>`;
            digestHTML += `<td style="padding: 10px; text-align: right; color: var(--primary);">${hourCompletion}%</td>`;
            digestHTML += `</tr>`;
            digestHTML += `<tr>`;
            digestHTML += `<td style="padding: 10px; text-align: left;"><strong>High Priority Tasks:</strong></td>`;
            digestHTML += `<td style="padding: 10px; text-align: right; color: var(--accent);">${highPriorityCompleted}/${highPriorityAssigned}</td>`;
            digestHTML += `</tr>`;
            digestHTML += `</table>`;

            // Module Breakdown
            if (moduleBreakdown.length > 0) {
                digestHTML += `<h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid rgba(0, 212, 255, 0.3); padding-bottom: 10px;">MODULE BREAKDOWN</h3>`;

                moduleBreakdown.forEach(mod => {
                    digestHTML += `<div style="background: rgba(0, 99, 255, 0.1); padding: 15px; margin-bottom: 15px; border-radius: 4px; border-left: 4px solid var(--primary);">`;
                    digestHTML += `<h4 style="color: var(--primary); margin-bottom: 10px;">${mod.icon} ${mod.name}</h4>`;
                    digestHTML += `<table style="width: 100%; font-size: 0.85rem;">`;
                    digestHTML += `<tr><td style="padding: 5px;">Tasks:</td><td style="text-align: right;">${mod.completed}/${mod.assigned}</td></tr>`;
                    digestHTML += `<tr><td style="padding: 5px;">Completion:</td><td style="text-align: right; color: var(--primary);">${mod.completion}%</td></tr>`;
                    digestHTML += `<tr><td style="padding: 5px;">Hours:</td><td style="text-align: right;">${mod.hoursCompleted.toFixed(1)}/${mod.hoursAssigned.toFixed(1)}h</td></tr>`;
                    if (mod.highPriority > 0) {
                        digestHTML += `<tr><td style="padding: 5px; color: var(--accent);">High Priority:</td><td style="text-align: right; color: var(--accent);">${mod.highPriorityCompleted}/${mod.highPriority}</td></tr>`;
                    }
                    digestHTML += `</table>`;
                    digestHTML += `</div>`;
                });
            }

            digestHTML += `<hr style="border: none; border-top: 1px solid rgba(0, 212, 255, 0.2); margin: 30px 0;">`;
            digestHTML += `<p style="font-size: 0.85rem; color: var(--text-secondary); text-align: center;">Generated by Life OS Command Center</p>`;

            currentDigestContent = digestHTML;
            document.getElementById('digestContent').innerHTML = digestHTML;
            document.getElementById('digestModal').classList.add('active');
        }

        function closeDigestModal() {
            document.getElementById('digestModal').classList.remove('active');
        }

        function copyDigestToClipboard() {
            const text = document.getElementById('digestContent').innerText;
            const blob = new Blob([text], { type: 'text/plain' });
            const tempDiv = document.createElement('textarea');
            tempDiv.value = text;
            document.body.appendChild(tempDiv);
            tempDiv.select();
            document.execCommand('copy');
            document.body.removeChild(tempDiv);

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì COPIED';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        function downloadDigestReport() {
            const text = document.getElementById('digestContent').innerText;
            const filename = `life-os-weekly-digest-${new Date().toISOString().split('T')[0]}.txt`;

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function openNotesModal(taskId) {
            if (!currentModule) return;

            const tasks = JSON.parse(localStorage.getItem(currentModule.storageKey) || '{}');
            const taskData = tasks[taskId];

            if (!taskData || typeof taskData !== 'object') {
                alert('TASK NOT FOUND');
                return;
            }

            currentEditingTaskId = taskId;
            const label = taskData.label || 'Task';

            document.getElementById('notesTaskTitle').textContent = label;
            document.getElementById('notesText').value = taskData.notes || '';

            // Render subtasks
            const subtasksList = document.getElementById('subtasksList');
            subtasksList.innerHTML = '';

            const subtasks = taskData.subtasks || [];
            if (subtasks.length === 0) {
                subtasksList.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 20px; font-style: italic;">NO SUBTASKS YET</div>';
            } else {
                subtasks.forEach((subtask, index) => {
                    const completed = subtask.completed || false;
                    const subtaskDiv = document.createElement('div');
                    subtaskDiv.className = 'subtask-item';
                    subtaskDiv.innerHTML = `
                        <input type="checkbox" id="st-${index}" ${completed ? 'checked' : ''} onchange="toggleSubtask(${index})">
                        <label for="st-${index}">${subtask.label}</label>
                        <button class="subtask-delete" onclick="deleteSubtask(${index})">‚úï</button>
                    `;
                    subtasksList.appendChild(subtaskDiv);
                });
            }

            document.getElementById('notesModal').classList.add('active');
            document.getElementById('subtaskInput').value = '';
        }

        function closeNotesModal() {
            document.getElementById('notesModal').classList.remove('active');
            currentEditingTaskId = null;
        }

        function addSubtask() {
            try {
                const input = document.getElementById('subtaskInput');
                const label = input.value.trim();

                if (!label) {
                    alert('SUBTASK DESCRIPTION REQUIRED');
                    return;
                }

                if (label.length > 100) {
                    alert('SUBTASK TOO LONG (MAX 100 CHARACTERS)');
                    return;
                }

                const tasks = getStorageData(currentModule.storageKey);
                const taskData = tasks[currentEditingTaskId];

                // Save state for undo/redo before making changes
                UndoRedoManager.saveState(`Subtask added: "${label}"`);

                if (!taskData.subtasks) {
                    taskData.subtasks = [];
                }

                taskData.subtasks.push({
                    label: label.toUpperCase(),
                    completed: false
                });

                tasks[currentEditingTaskId] = taskData;

                if (!setStorageData(currentModule.storageKey, tasks)) {
                    console.error('Failed to save subtask');
                    return;
                }

                input.value = '';
                updateUndoRedoButtons();
                openNotesModal(currentEditingTaskId);
            } catch(error) {
                console.error('Error adding subtask:', error);
            }
        }

        function deleteSubtask(index) {
            try {
                const tasks = getStorageData(currentModule.storageKey);
                const taskData = tasks[currentEditingTaskId];

                if (taskData.subtasks) {
                    // Save state for undo/redo before making changes
                    UndoRedoManager.saveState(`Subtask deleted`);

                    taskData.subtasks.splice(index, 1);
                    tasks[currentEditingTaskId] = taskData;

                    if (!setStorageData(currentModule.storageKey, tasks)) {
                        console.error('Failed to save subtask deletion');
                        return;
                    }

                    updateUndoRedoButtons();
                    openNotesModal(currentEditingTaskId);
                }
            } catch(error) {
                console.error('Error deleting subtask:', error);
            }
        }

        function toggleSubtask(index) {
            try {
                const checkbox = document.getElementById(`st-${index}`);
                const tasks = getStorageData(currentModule.storageKey);
                const taskData = tasks[currentEditingTaskId];

                if (taskData.subtasks && taskData.subtasks[index]) {
                    // Save state for undo/redo before making changes
                    UndoRedoManager.saveState(`Subtask toggled`);

                    taskData.subtasks[index].completed = checkbox.checked;
                    tasks[currentEditingTaskId] = taskData;

                    if (!setStorageData(currentModule.storageKey, tasks)) {
                        console.error('Failed to save subtask toggle');
                        return;
                    }

                    updateUndoRedoButtons();
                }
            } catch(error) {
                console.error('Error toggling subtask:', error);
            }
        }

        function saveTaskDetails() {
            if (!currentEditingTaskId) return;

            try {
                const tasks = getStorageData(currentModule.storageKey);
                const taskData = tasks[currentEditingTaskId];

                if (taskData && typeof taskData === 'object') {
                    // Save state for undo/redo before making changes
                    UndoRedoManager.saveState(`Task notes updated`);

                    taskData.notes = document.getElementById('notesText').value;
                    tasks[currentEditingTaskId] = taskData;

                    if (!setStorageData(currentModule.storageKey, tasks)) {
                        console.error('Failed to save task details');
                        return;
                    }

                    closeNotesModal();
                    renderDetailView(currentModule);
                    updateGlobalStats();
                    updateUndoRedoButtons();
                }
            } catch(error) {
                console.error('Error saving task details:', error);
            }
        }

        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('light-theme');

            // Save theme preference
            const theme = body.classList.contains('light-theme') ? 'light' : 'dark';
            localStorage.setItem('life-os-theme', theme);

            // Update button text and ARIA state
            const themeBtn = document.querySelector('.theme-toggle');
            themeBtn.textContent = theme === 'light' ? 'üåô DARK' : 'üåì LIGHT';
            themeBtn.setAttribute('aria-pressed', theme === 'light' ? 'true' : 'false');

            // Update URL to reflect theme change
            const params = getURLParameters();
            updateURL({
                ...params,
                theme: theme
            });
        }

        function openHeatmapModal() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Calculate 90 days of activity
            const activityData = {};
            for (let i = 89; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateKey = date.toISOString().split('T')[0];
                activityData[dateKey] = { completed: 0, total: 0, percentage: 0 };
            }

            // Scan all modules and tasks
            modules.forEach(module => {
                const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
                Object.values(tasks).forEach(taskData => {
                    if (typeof taskData === 'object' && taskData.createdAt) {
                        const taskDate = new Date(taskData.createdAt);
                        taskDate.setHours(0, 0, 0, 0);
                        const dateKey = taskDate.toISOString().split('T')[0];

                        if (activityData[dateKey]) {
                            activityData[dateKey].total++;
                            if (taskData.completed) {
                                activityData[dateKey].completed++;
                            }
                        }
                    }
                });
            });

            // Calculate completion percentages and activity levels
            const activityLevels = {};
            Object.entries(activityData).forEach(([date, data]) => {
                if (data.total > 0) {
                    data.percentage = Math.round((data.completed / data.total) * 100);
                } else {
                    data.percentage = 0;
                }

                // Assign activity level (0-4)
                if (data.total === 0) {
                    activityLevels[date] = 0;
                } else if (data.percentage < 25) {
                    activityLevels[date] = 1;
                } else if (data.percentage < 50) {
                    activityLevels[date] = 2;
                } else if (data.percentage < 75) {
                    activityLevels[date] = 3;
                } else {
                    activityLevels[date] = 4;
                }
            });

            // Generate heatmap HTML
            let heatmapHTML = '<div class="heatmap-grid">';

            // Get 90-day range
            let currentDate = new Date(today);
            currentDate.setDate(currentDate.getDate() - 89);

            for (let i = 0; i < 90; i++) {
                const dateKey = currentDate.toISOString().split('T')[0];
                const dayOfWeek = currentDate.toLocaleDateString('en-US', { weekday: 'short' });
                const dayNum = currentDate.getDate();
                const activity = activityLevels[dateKey] || 0;
                const activityData_day = activityData[dateKey];

                const tooltip = activityData_day.total > 0
                    ? `${activityData_day.completed}/${activityData_day.total} (${activityData_day.percentage}%)`
                    : 'No tasks';

                heatmapHTML += `<div class="heatmap-cell activity-${activity}" title="${dateKey}: ${tooltip}">${dayNum}</div>`;
                currentDate.setDate(currentDate.getDate() + 1);
            }

            heatmapHTML += '</div>';

            // Add legend
            heatmapHTML += `<div class="heatmap-legend" style="display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; justify-content: center;">`;
            heatmapHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="heatmap-cell activity-0" style="width: 30px; height: 30px;"></div><span>No Activity</span></div>`;
            heatmapHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="heatmap-cell activity-1" style="width: 30px; height: 30px;"></div><span>Low (1-25%)</span></div>`;
            heatmapHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="heatmap-cell activity-2" style="width: 30px; height: 30px;"></div><span>Medium (26-50%)</span></div>`;
            heatmapHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="heatmap-cell activity-3" style="width: 30px; height: 30px;"></div><span>High (51-75%)</span></div>`;
            heatmapHTML += `<div style="display: flex; align-items: center; gap: 8px;"><div class="heatmap-cell activity-4" style="width: 30px; height: 30px;"></div><span>Very High (76-100%)</span></div>`;
            heatmapHTML += `</div>`;

            heatmapHTML += `<p style="margin-top: 20px; font-size: 0.85rem; color: var(--text-secondary); text-align: center;">Last 90 days of activity - hover over cells to see details</p>`;

            document.getElementById('heatmapContent').innerHTML = heatmapHTML;
            document.getElementById('heatmapModal').classList.add('active');
            document.getElementById('heatmapBtn').setAttribute('aria-expanded', 'true');
        }

        function closeHeatmapModal() {
            document.getElementById('heatmapModal').classList.remove('active');
            document.getElementById('heatmapBtn').setAttribute('aria-expanded', 'false');
        }

        function openAnalyticsModal() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Calculate 30-day window
            const thirtyDaysAgo = new Date(today);
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 29);

            let analyticsHTML = '';
            analyticsHTML += `<h3 style="color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid rgba(0, 212, 255, 0.3); padding-bottom: 10px;">PERFORMANCE ANALYTICS DASHBOARD</h3>`;
            analyticsHTML += `<p style="margin-bottom: 20px;"><strong>Generated:</strong> ${new Date().toLocaleString()}</p>`;

            // Collect data
            let allTasks = [];
            let moduleStats = [];
            let totalTasksCompleted = 0;
            let totalTasksCreated = 0;
            let totalHoursCompleted = 0;
            let totalHoursEstimated = 0;
            let highPriorityCompleted = 0;
            let highPriorityTotal = 0;

            modules.forEach(module => {
                const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
                let moduleCompleted = 0;
                let moduleCreated = 0;
                let moduleHoursCompleted = 0;
                let moduleHoursEstimated = 0;
                let moduleHighPriority = 0;
                let moduleHighPriorityCompleted = 0;

                Object.entries(tasks).forEach(([id, taskData]) => {
                    if (typeof taskData === 'object') {
                        const createdDate = new Date(taskData.createdAt || 0);
                        createdDate.setHours(0, 0, 0, 0);
                        const isThisMonth = createdDate >= thirtyDaysAgo && createdDate <= today;

                        if (isThisMonth) {
                            moduleCreated++;
                            totalTasksCreated++;
                            const estimate = taskData.estimate || 0;
                            moduleHoursEstimated += estimate;
                            totalHoursEstimated += estimate;

                            if (taskData.completed) {
                                moduleCompleted++;
                                totalTasksCompleted++;
                                moduleHoursCompleted += estimate;
                                totalHoursCompleted += estimate;
                            }

                            if (taskData.priority === 'high') {
                                moduleHighPriority++;
                                highPriorityTotal++;
                                if (taskData.completed) {
                                    moduleHighPriorityCompleted++;
                                    highPriorityCompleted++;
                                }
                            }

                            allTasks.push({
                                module: module.name,
                                icon: module.icon,
                                label: taskData.label,
                                completed: taskData.completed,
                                priority: taskData.priority || 'medium',
                                estimate: estimate,
                                createdDate: createdDate
                            });
                        }
                    }
                });

                if (moduleCreated > 0) {
                    moduleStats.push({
                        name: module.name,
                        icon: module.icon,
                        created: moduleCreated,
                        completed: moduleCompleted,
                        hoursEstimated: moduleHoursEstimated,
                        hoursCompleted: moduleHoursCompleted,
                        highPriority: moduleHighPriority,
                        highPriorityCompleted: moduleHighPriorityCompleted
                    });
                }
            });

            // Overall Summary
            analyticsHTML += `<h3 style="color: var(--primary); margin-top: 25px; margin-bottom: 15px; border-bottom: 2px solid rgba(0, 212, 255, 0.3); padding-bottom: 10px;">OVERALL SUMMARY (Last 30 Days)</h3>`;
            analyticsHTML += `<table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">`;

            const taskCompletionRate = totalTasksCreated > 0 ? Math.round((totalTasksCompleted / totalTasksCreated) * 100) : 0;
            const hourCompletionRate = totalHoursEstimated > 0 ? Math.round((totalHoursCompleted / totalHoursEstimated) * 100) : 0;
            const highPriorityRate = highPriorityTotal > 0 ? Math.round((highPriorityCompleted / highPriorityTotal) * 100) : 0;
            const avgTasksPerDay = totalTasksCreated > 0 ? (totalTasksCreated / 30).toFixed(1) : 0;
            const avgHoursPerDay = totalHoursEstimated > 0 ? (totalHoursEstimated / 30).toFixed(1) : 0;

            analyticsHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            analyticsHTML += `<td style="padding: 10px;"><strong>Tasks Created:</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right; color: var(--primary);">${totalTasksCreated}</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            analyticsHTML += `<td style="padding: 10px;"><strong>Tasks Completed:</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right; color: var(--success);">${totalTasksCompleted}</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            analyticsHTML += `<td style="padding: 10px;"><strong>Completion Rate:</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right; color: ${taskCompletionRate >= 75 ? 'var(--success)' : taskCompletionRate >= 50 ? 'var(--warning)' : 'var(--accent)'};">${taskCompletionRate}%</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            analyticsHTML += `<td style="padding: 10px;"><strong>Hours Estimated:</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right;">${totalHoursEstimated.toFixed(1)}h</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            analyticsHTML += `<td style="padding: 10px;"><strong>Hours Completed:</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right; color: var(--success);">${totalHoursCompleted.toFixed(1)}h</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            analyticsHTML += `<td style="padding: 10px;"><strong>Hour Completion Rate:</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right; color: ${hourCompletionRate >= 75 ? 'var(--success)' : hourCompletionRate >= 50 ? 'var(--warning)' : 'var(--accent)'};">${hourCompletionRate}%</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            analyticsHTML += `<td style="padding: 10px;"><strong>High Priority (Completed/Total):</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right; color: var(--accent);">${highPriorityCompleted}/${highPriorityTotal} (${highPriorityRate}%)</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `<tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">`;
            analyticsHTML += `<td style="padding: 10px;"><strong>Avg Tasks/Day:</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right;">${avgTasksPerDay}</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `<tr>`;
            analyticsHTML += `<td style="padding: 10px;"><strong>Avg Hours/Day:</strong></td>`;
            analyticsHTML += `<td style="padding: 10px; text-align: right;">${avgHoursPerDay}h</td>`;
            analyticsHTML += `</tr>`;
            analyticsHTML += `</table>`;

            // Module Performance
            if (moduleStats.length > 0) {
                analyticsHTML += `<h3 style="color: var(--primary); margin-top: 25px; margin-bottom: 15px; border-bottom: 2px solid rgba(0, 212, 255, 0.3); padding-bottom: 10px;">MODULE PERFORMANCE</h3>`;

                // Sort by completion rate
                moduleStats.sort((a, b) => {
                    const rateA = a.created > 0 ? (a.completed / a.created) : 0;
                    const rateB = b.created > 0 ? (b.completed / b.created) : 0;
                    return rateB - rateA;
                });

                moduleStats.forEach(mod => {
                    const rate = mod.created > 0 ? Math.round((mod.completed / mod.created) * 100) : 0;
                    analyticsHTML += `<div style="background: rgba(0, 99, 255, 0.1); padding: 12px; margin-bottom: 12px; border-radius: 4px; border-left: 4px solid ${rate >= 75 ? 'var(--success)' : rate >= 50 ? 'var(--warning)' : 'var(--accent)'};">`;
                    analyticsHTML += `<h4 style="color: var(--primary); margin-bottom: 8px;">${mod.icon} ${mod.name}</h4>`;
                    analyticsHTML += `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8rem;">`;
                    analyticsHTML += `<div><strong>Completion:</strong> ${mod.completed}/${mod.created} (${rate}%)</div>`;
                    analyticsHTML += `<div><strong>Hours:</strong> ${mod.hoursCompleted.toFixed(1)}/${mod.hoursEstimated.toFixed(1)}h</div>`;
                    if (mod.highPriority > 0) {
                        const highRate = Math.round((mod.highPriorityCompleted / mod.highPriority) * 100);
                        analyticsHTML += `<div style="color: var(--accent);"><strong>High Priority:</strong> ${mod.highPriorityCompleted}/${mod.highPriority} (${highRate}%)</div>`;
                    }
                    analyticsHTML += `</div>`;
                    analyticsHTML += `</div>`;
                });

                // Best and Worst
                const bestModule = moduleStats[0];
                const worstModule = moduleStats[moduleStats.length - 1];
                analyticsHTML += `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">`;
                analyticsHTML += `<div style="background: rgba(0, 255, 136, 0.15); padding: 12px; border-radius: 4px; border: 1px solid var(--success);">`;
                analyticsHTML += `<strong style="color: var(--success);">üèÜ Best Performer</strong><br>`;
                analyticsHTML += `${bestModule.icon} ${bestModule.name}<br>`;
                const bestRate = bestModule.created > 0 ? Math.round((bestModule.completed / bestModule.created) * 100) : 0;
                analyticsHTML += `<small style="color: var(--text-secondary);">${bestRate}% completion rate</small>`;
                analyticsHTML += `</div>`;
                analyticsHTML += `<div style="background: rgba(255, 0, 110, 0.15); padding: 12px; border-radius: 4px; border: 1px solid var(--accent);">`;
                analyticsHTML += `<strong style="color: var(--accent);">‚ö†Ô∏è Needs Attention</strong><br>`;
                analyticsHTML += `${worstModule.icon} ${worstModule.name}<br>`;
                const worstRate = worstModule.created > 0 ? Math.round((worstModule.completed / worstModule.created) * 100) : 0;
                analyticsHTML += `<small style="color: var(--text-secondary);">${worstRate}% completion rate</small>`;
                analyticsHTML += `</div>`;
                analyticsHTML += `</div>`;
            }

            analyticsHTML += `<hr style="border: none; border-top: 1px solid rgba(0, 212, 255, 0.2); margin: 25px 0;">`;
            analyticsHTML += `<p style="font-size: 0.75rem; color: var(--text-secondary); text-align: center;">Performance data calculated from tasks created in the last 30 days</p>`;

            document.getElementById('analyticsContent').innerHTML = analyticsHTML;
            document.getElementById('analyticsModal').classList.add('active');
            document.getElementById('analyticsBtn').setAttribute('aria-expanded', 'true');
        }

        function closeAnalyticsModal() {
            document.getElementById('analyticsModal').classList.remove('active');
            document.getElementById('analyticsBtn').setAttribute('aria-expanded', 'false');
        }

        function copyAnalyticsToClipboard() {
            const text = document.getElementById('analyticsContent').innerText;
            const tempDiv = document.createElement('textarea');
            tempDiv.value = text;
            document.body.appendChild(tempDiv);
            tempDiv.select();
            document.execCommand('copy');
            document.body.removeChild(tempDiv);

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì COPIED';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        function downloadAnalyticsReport() {
            const text = document.getElementById('analyticsContent').innerText;
            const filename = `life-os-analytics-${new Date().toISOString().split('T')[0]}.txt`;

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Sync Modal Functions
        function openSyncModal() {
            document.getElementById('syncModal').classList.add('active');
            document.getElementById('syncBtn').setAttribute('aria-expanded', 'true');
        }

        function closeSyncModal() {
            document.getElementById('syncModal').classList.remove('active');
            document.getElementById('syncBtn').setAttribute('aria-expanded', 'false');
        }

        function showSyncTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.sync-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove active state from all buttons
            document.querySelectorAll('.sync-tab-btn').forEach(btn => {
                btn.style.background = 'transparent';
                btn.style.color = 'var(--text-secondary)';
            });

            // Show selected tab
            const selectedTab = document.getElementById(`syncTab-${tabName}`);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }

            // Set active button
            const activeBtn = document.getElementById(`tab-${tabName}`);
            if (activeBtn) {
                activeBtn.style.background = 'rgba(0, 212, 255, 0.2)';
                activeBtn.style.color = 'var(--primary)';
            }
        }

        // Help Modal Functions
        function openHelpModal() {
            document.getElementById('helpModal').classList.add('active');
            document.getElementById('helpBtn').setAttribute('aria-expanded', 'true');
            // Show quick start tab by default
            showHelpTab('quickstart');
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.remove('active');
            document.getElementById('helpBtn').setAttribute('aria-expanded', 'false');
        }

        function showHelpTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.help-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove active state from all buttons
            document.querySelectorAll('.help-tab-btn').forEach(btn => {
                btn.style.background = 'transparent';
                btn.style.color = 'var(--text-secondary)';
            });

            // Show selected tab
            const selectedTab = document.getElementById(`help-${tabName}`);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }

            // Set active button
            const activeBtn = document.getElementById(`help-tab-${tabName}`);
            if (activeBtn) {
                activeBtn.style.background = 'rgba(0, 212, 255, 0.2)';
                activeBtn.style.color = 'var(--primary)';
            }
        }

        function showOnboardingBanner() {
            const hasSeenOnboarding = localStorage.getItem('life-os-onboarding-shown');
            if (!hasSeenOnboarding) {
                const banner = document.getElementById('onboardingBanner');
                if (banner) {
                    banner.style.display = 'block';
                    // Add animation
                    banner.classList.add('slideDown');
                }
            }
        }

        function dismissOnboardingBanner() {
            const banner = document.getElementById('onboardingBanner');
            if (banner) {
                banner.style.display = 'none';
            }
            // Mark as seen
            localStorage.setItem('life-os-onboarding-shown', 'true');
        }

        // Export Functions
        function exportDataAsJSON() {
            const allData = {};

            // Collect all module data
            modules.forEach(module => {
                const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
                allData[module.storageKey] = tasks;
            });

            // Add theme preference
            allData['life-os-theme'] = localStorage.getItem('life-os-theme') || 'dark';
            allData['export-date'] = new Date().toISOString();
            allData['export-version'] = '2.0';

            // Create download
            const filename = `life-os-backup-${new Date().toISOString().split('T')[0]}.json`;
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Show confirmation
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì EXPORTED';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        function copyDataToClipboard() {
            const allData = {};

            modules.forEach(module => {
                const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
                allData[module.storageKey] = tasks;
            });

            allData['life-os-theme'] = localStorage.getItem('life-os-theme') || 'dark';
            allData['export-date'] = new Date().toISOString();

            const jsonString = JSON.stringify(allData, null, 2);
            const tempDiv = document.createElement('textarea');
            tempDiv.value = jsonString;
            document.body.appendChild(tempDiv);
            tempDiv.select();
            document.execCommand('copy');
            document.body.removeChild(tempDiv);

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì COPIED';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        // Import Functions
        function importDataFromJSON() {
            try {
                const jsonString = document.getElementById('importJSON').value.trim();

                if (!jsonString) {
                    alert('‚ö†Ô∏è Please paste JSON data first');
                    return;
                }

                const importedData = JSON.parse(jsonString);

                // Import module data
                let importedCount = 0;
                modules.forEach(module => {
                    if (importedData[module.storageKey]) {
                        localStorage.setItem(module.storageKey, JSON.stringify(importedData[module.storageKey]));
                        importedCount++;
                    }
                });

                // Import theme if present
                if (importedData['life-os-theme']) {
                    localStorage.setItem('life-os-theme', importedData['life-os-theme']);
                }

                alert(`‚úì Successfully imported ${importedCount} modules!`);

                // Refresh the app
                location.reload();
            } catch (error) {
                alert(`‚ùå Error importing data: ${error.message}`);
            }
        }

        function clearImportField() {
            document.getElementById('importJSON').value = '';
        }

        // GitHub Integration Functions
        function validateGitHubCredentials() {
            const token = document.getElementById('githubToken').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();

            if (!token || !repo) {
                alert('‚ö†Ô∏è Please enter both GitHub token and repository');
                return;
            }

            const [owner, repoName] = repo.split('/');

            if (!owner || !repoName) {
                alert('‚ö†Ô∏è Repository format should be: username/repository');
                return;
            }

            // Test the connection
            fetch(`https://api.github.com/repos/${owner}/${repoName}`, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => {
                if (response.status === 200) {
                    alert('‚úì Connection successful! Repository access verified.');
                } else if (response.status === 404) {
                    alert('‚ùå Repository not found');
                } else if (response.status === 401) {
                    alert('‚ùå Invalid GitHub token');
                } else {
                    alert(`‚ùå Error: ${response.status}`);
                }
            })
            .catch(error => {
                alert(`‚ùå Connection failed: ${error.message}`);
            });
        }

        function exportToGitHubIssues() {
            const token = document.getElementById('githubToken').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const onlyPending = document.getElementById('gh-only-pending').checked;
            const highPriorityOnly = document.getElementById('gh-high-priority').checked;

            if (!token || !repo) {
                alert('‚ö†Ô∏è Please enter both GitHub token and repository');
                return;
            }

            const [owner, repoName] = repo.split('/');

            if (!owner || !repoName) {
                alert('‚ö†Ô∏è Repository format should be: username/repository');
                return;
            }

            // Collect tasks to export
            const tasksToExport = [];

            modules.forEach(module => {
                const tasks = JSON.parse(localStorage.getItem(module.storageKey) || '{}');
                Object.entries(tasks).forEach(([id, taskData]) => {
                    if (typeof taskData === 'object') {
                        // Apply filters
                        if (onlyPending && taskData.completed) return;
                        if (highPriorityOnly && taskData.priority !== 'high') return;

                        tasksToExport.push({
                            title: `[${module.icon} ${module.name}] ${taskData.label}`,
                            body: generateGitHubIssueBody(taskData, module),
                            labels: generateGitHubLabels(taskData),
                            priority: taskData.priority || 'medium'
                        });
                    }
                });
            });

            if (tasksToExport.length === 0) {
                alert('‚ùå No tasks match your filter criteria');
                return;
            }

            // Export issues
            let successCount = 0;
            let failCount = 0;

            const exportPromises = tasksToExport.map(task => {
                return fetch(`https://api.github.com/repos/${owner}/${repoName}/issues`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: task.title,
                        body: task.body,
                        labels: task.labels
                    })
                })
                .then(response => {
                    if (response.ok) {
                        successCount++;
                    } else {
                        failCount++;
                    }
                })
                .catch(error => {
                    failCount++;
                });
            });

            Promise.all(exportPromises).then(() => {
                alert(`‚úì Export complete!\n‚úì Created: ${successCount} issues\n‚ùå Failed: ${failCount}`);
            });
        }

        function generateGitHubIssueBody(taskData, module) {
            let body = `**Module:** ${module.icon} ${module.name}\n\n`;
            body += `**Status:** ${taskData.completed ? '‚úÖ Completed' : '‚è≥ Pending'}\n`;
            body += `**Priority:** ${taskData.priority === 'high' ? 'üî¥' : taskData.priority === 'low' ? 'üü¢' : 'üü†'} ${taskData.priority.toUpperCase()}\n`;

            if (taskData.estimate) {
                body += `**Time Estimate:** ${taskData.estimate} hours\n`;
            }

            if (taskData.notes) {
                body += `\n**Notes:**\n${taskData.notes}\n`;
            }

            if (taskData.subtasks && taskData.subtasks.length > 0) {
                body += `\n**Subtasks:**\n`;
                taskData.subtasks.forEach(subtask => {
                    const status = subtask.completed ? '[x]' : '[ ]';
                    body += `${status} ${subtask.label}\n`;
                });
            }

            body += `\n---\n*Exported from Life OS on ${new Date().toLocaleString()}*`;
            return body;
        }

        function generateGitHubLabels(taskData) {
            const labels = [];

            if (taskData.priority === 'high') {
                labels.push('priority-high');
            } else if (taskData.priority === 'low') {
                labels.push('priority-low');
            } else {
                labels.push('priority-medium');
            }

            if (taskData.completed) {
                labels.push('status-completed');
            } else {
                labels.push('status-pending');
            }

            if (taskData.estimate && taskData.estimate > 5) {
                labels.push('large-task');
            }

            return labels;
        }

        // Undo/Redo Control Functions
        function updateUndoRedoButtons() {
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');

            if (UndoRedoManager.canUndo()) {
                undoBtn.disabled = false;
                undoBtn.style.opacity = '1';
            } else {
                undoBtn.disabled = true;
                undoBtn.style.opacity = '0.5';
            }

            if (UndoRedoManager.canRedo()) {
                redoBtn.disabled = false;
                redoBtn.style.opacity = '1';
            } else {
                redoBtn.disabled = true;
                redoBtn.style.opacity = '0.5';
            }
        }

        function undoAction() {
            if (UndoRedoManager.undo()) {
                // Refresh the current view
                if (currentModule) {
                    renderDetailView(currentModule);
                } else {
                    renderDashboard();
                }
                updateGlobalStats();
            }
        }

        function redoAction() {
            if (UndoRedoManager.redo()) {
                // Refresh the current view
                if (currentModule) {
                    renderDetailView(currentModule);
                } else {
                    renderDashboard();
                }
                updateGlobalStats();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // ============================================
            // APPLY URL PARAMETERS AND THEME
            // ============================================

            // Parse URL parameters
            const urlParams = getURLParameters();

            // Determine theme from URL param (overrides localStorage)
            const urlTheme = urlParams.theme;
            const savedTheme = urlTheme || localStorage.getItem('life-os-theme');
            const themeBtn = document.querySelector('.theme-toggle');

            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                themeBtn.textContent = 'üåô DARK';
                themeBtn.setAttribute('aria-pressed', 'true');
                localStorage.setItem('life-os-theme', 'light');
            } else {
                themeBtn.setAttribute('aria-pressed', 'false');
                localStorage.setItem('life-os-theme', 'dark');
            }

            // Request notification permission
            requestNotificationPermission();

            modules.forEach(m => initializeDefaultTasks(m));

            // Apply module from URL parameter
            if (urlParams.module) {
                const targetModule = modules.find(m => m.id === urlParams.module);
                if (targetModule) {
                    currentModule = targetModule;
                    document.getElementById('overviewView').classList.add('hidden-view');
                    document.getElementById('detailView').classList.remove('hidden-view');
                    renderDetailView(targetModule);

                    // Highlight selected module
                    document.querySelectorAll('.module-card').forEach(card => {
                        card.classList.remove('active');
                    });
                    const activeCard = document.querySelector(`[data-module-id="${targetModule.id}"]`);
                    if (activeCard) {
                        activeCard.classList.add('active');
                    }
                }
            }

            // Apply filter from URL parameter
            if (urlParams.filter && ['all', 'today', 'week', 'high'].includes(urlParams.filter)) {
                currentFilter = urlParams.filter;
                if (currentModule) {
                    renderDetailView(currentModule);
                }
            }

            // If no module specified, show dashboard
            if (!urlParams.module) {
                renderDashboard();
                updateGlobalStats();
            } else {
                updateGlobalStats();
            }

            // Add keyboard shortcuts for undo/redo
            document.addEventListener('keydown', (e) => {
                // Cmd+Z or Ctrl+Z for undo
                if ((e.metaKey || e.ctrlKey) && e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undoAction();
                }
                // Cmd+Shift+Z or Ctrl+Shift+Z for redo
                else if ((e.metaKey || e.ctrlKey) && e.key === 'z' && e.shiftKey) {
                    e.preventDefault();
                    redoAction();
                }
                // Also support Cmd+Y or Ctrl+Y for redo (common in some apps)
                else if ((e.metaKey || e.ctrlKey) && e.key === 'y') {
                    e.preventDefault();
                    redoAction();
                }
                // Cmd+? or Ctrl+? for help
                else if ((e.metaKey || e.ctrlKey) && e.key === '?') {
                    e.preventDefault();
                    openHelpModal();
                }
            });

            // Show onboarding banner for first-time users
            showOnboardingBanner();
        });
    </script>
</body>
</html>
